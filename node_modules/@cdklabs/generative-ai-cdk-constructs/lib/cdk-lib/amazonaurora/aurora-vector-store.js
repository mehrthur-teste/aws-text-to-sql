"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AmazonAuroraVectorStore = exports.ExistingAmazonAuroraVectorStore = exports.SupportedPostgreSQLVersions = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const path = require("path");
const cdk = require("aws-cdk-lib");
const ec2 = require("aws-cdk-lib/aws-ec2");
const iam = require("aws-cdk-lib/aws-iam");
const rds = require("aws-cdk-lib/aws-rds");
const cdk_nag_1 = require("cdk-nag");
const constructs_1 = require("constructs");
const custom_resource_provider_helper_1 = require("../../common/helpers/custom-resource-provider-helper");
const utils_1 = require("../../common/helpers/utils");
const vpc_helper_1 = require("../../common/helpers/vpc-helper");
/**
 * List of supported versions of PostgreSQL for Aurora cluster.
 */
exports.SupportedPostgreSQLVersions = {
    AURORA_POSTGRESQL_V12_16: rds.AuroraPostgresEngineVersion.VER_12_16,
    AURORA_POSTGRESQL_V13_12: rds.AuroraPostgresEngineVersion.VER_13_12,
    AURORA_POSTGRESQL_V14_9: rds.AuroraPostgresEngineVersion.VER_14_9,
    AURORA_POSTGRESQL_V15_4: rds.AuroraPostgresEngineVersion.VER_15_4,
    AURORA_POSTGRESQL_V15_5: rds.AuroraPostgresEngineVersion.VER_15_5,
    AURORA_POSTGRESQL_V15_6: rds.AuroraPostgresEngineVersion.VER_15_6,
    AURORA_POSTGRESQL_V15_7: rds.AuroraPostgresEngineVersion.VER_15_7,
    AURORA_POSTGRESQL_V15_8: rds.AuroraPostgresEngineVersion.VER_15_8,
    AURORA_POSTGRESQL_V16_1: rds.AuroraPostgresEngineVersion.VER_16_1,
    AURORA_POSTGRESQL_V16_2: rds.AuroraPostgresEngineVersion.VER_16_2,
    AURORA_POSTGRESQL_V16_3: rds.AuroraPostgresEngineVersion.VER_16_3,
};
/**
 * Base class for Amazon Aurora Vector Store.
 * Handles both the creation of a new Aurora Vector Store or the usage of an existing Aurora Vector Store.
 */
class BaseAmazonAuroraVectorStore extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        /**
         * Setup databaseName based on if it is provided in the props or not
         * and based on whether it is an existing Aurora Vector Store or not.
         */
        this.databaseName = 'clusterIdentifier' in props ? props.databaseName : props.databaseName ?? 'bedrock_vector_db';
        this.schemaName = props.schemaName ?? 'bedrock_integration';
        this.vectorField = props.vectorField ?? 'embedding';
        this.textField = props.textField ?? 'chunks';
        this.metadataField = props.metadataField ?? 'metadata';
        this.tableName = props.tableName ?? 'bedrock_kb';
        this.primaryKeyField = props.primaryKeyField ?? 'id';
        this.embeddingsModelVectorDimension = props.embeddingsModelVectorDimension;
    }
    createAuroraPgCRPolicy(clusterIdentifier) {
        const crPolicy = new iam.ManagedPolicy(this, 'AuroraPgPolicy', {
            managedPolicyName: (0, utils_1.generatePhysicalNameV2)(this, 'AuroraPgPolicy', {
                maxLength: 32,
                lower: true,
            }),
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'ec2:DescribeInstances',
                        'ec2:CreateNetworkInterface',
                        'ec2:AttachNetworkInterface',
                        'ec2:DescribeNetworkInterfaces',
                        'autoscaling:CompleteLifecycleAction',
                        'ec2:DeleteNetworkInterface',
                    ],
                    resources: ['*'],
                }),
                new iam.PolicyStatement({
                    actions: ['rds:DescribeDBClusters'],
                    resources: [
                        cdk.Stack.of(this).formatArn({
                            service: 'rds',
                            resource: 'cluster',
                            resourceName: clusterIdentifier,
                            arnFormat: cdk.ArnFormat.COLON_RESOURCE_NAME,
                            account: cdk.Stack.of(this).account,
                            region: cdk.Stack.of(this).region,
                        }),
                    ],
                }),
            ],
        });
        cdk_nag_1.NagSuppressions.addResourceSuppressions(crPolicy, [
            {
                id: 'AwsSolutions-IAM4',
                reason: 'The AWSLambdaBasicExecutionRole managed policy is required for ' +
                    'the Lambda function to write logs to CloudWatch.',
            },
            {
                id: 'AwsSolutions-IAM5',
                reason: 'This policy is required to allow the custom resource to create a ' +
                    'network interface for the Aurora cluster and it has to be wildcard.',
            },
        ], true);
        return crPolicy;
    }
    generateResourceArn(clusterIdentifier) {
        return cdk.Stack.of(this).formatArn({
            service: 'rds',
            resource: 'cluster',
            resourceName: clusterIdentifier,
            region: cdk.Stack.of(this).region,
            account: cdk.Stack.of(this).account,
            arnFormat: cdk.ArnFormat.COLON_RESOURCE_NAME,
        });
    }
    setupDatabaseClusterResources(vpc, secret, clusterIdentifier, auroraSecurityGroupId) {
        const resourceArn = this.generateResourceArn(clusterIdentifier);
        const auroraSecurityGroup = ec2.SecurityGroup.fromLookupById(this, 'ExistingSG', auroraSecurityGroupId);
        return {
            vpc,
            secret,
            resourceArn,
            auroraSecurityGroup,
            clusterIdentifier,
        };
    }
    createLambdaSecurityGroup(vpc) {
        return new ec2.SecurityGroup(this, 'LambdaSecurityGroup', {
            vpc,
            securityGroupName: 'lambda-security-group',
            description: 'Security group for Lambda access to Aurora',
        });
    }
    addIngressRuleToAuroraSecurityGroup(lambdaSecurityGroup, auroraSecurityGroup) {
        auroraSecurityGroup.addIngressRule(lambdaSecurityGroup, ec2.Port.tcp(5432), 'Allow PostgreSQL access from Lambda security group');
    }
    setupCustomResource(databaseClusterResources, lambdaSecurityGroup, auroraPgCRPolicy) {
        const customResource = (0, custom_resource_provider_helper_1.buildCustomResourceProvider)({
            providerName: 'AmazonAuroraPgVectorCRProvider',
            vpc: databaseClusterResources.vpc,
            securityGroup: lambdaSecurityGroup,
            codePath: path.join(__dirname, '../../../lambda/amazon-aurora-pgvector-custom-resources'),
            handler: 'custom_resources.on_event',
            runtime: cdk.aws_lambda.Runtime.PYTHON_3_12,
        });
        const crProvider = customResource.getProvider(this);
        crProvider.role.addManagedPolicy(auroraPgCRPolicy);
        databaseClusterResources.secret.grantRead(crProvider.role);
        const auroraPgVector = new cdk.CustomResource(this, 'AuroraPgVector', {
            resourceType: 'Custom::AmazonAuroraPgVector',
            serviceToken: crProvider.serviceToken,
            properties: {
                SecretName: databaseClusterResources.secret.secretName || '',
                ClusterIdentifier: databaseClusterResources.clusterIdentifier,
                DatabaseName: this.databaseName,
                TableName: this.tableName,
                VectorDimensions: this.embeddingsModelVectorDimension,
                PrimaryKeyField: this.primaryKeyField,
                SchemaName: this.schemaName,
                VectorField: this.vectorField,
                TextField: this.textField,
                MetadataField: this.metadataField,
            },
        });
        auroraPgVector.node.addDependency(auroraPgCRPolicy);
        return auroraPgVector;
    }
}
class ExistingAmazonAuroraVectorStore extends BaseAmazonAuroraVectorStore {
    constructor(scope, id, props) {
        super(scope, id, props);
        const databaseClusterResources = this.setupDatabaseClusterResources(props.vpc, props.secret, props.clusterIdentifier, props.auroraSecurityGroupId);
        const auroraPgCRPolicy = this.createAuroraPgCRPolicy(databaseClusterResources.clusterIdentifier);
        const lambdaSecurityGroup = this.createLambdaSecurityGroup(databaseClusterResources.vpc);
        this.addIngressRuleToAuroraSecurityGroup(lambdaSecurityGroup, databaseClusterResources.auroraSecurityGroup);
        this.resourceArn = this.generateResourceArn(databaseClusterResources.clusterIdentifier);
        this.credentialsSecretArn = databaseClusterResources.secret.secretArn;
        this.vpc = databaseClusterResources.vpc;
        (0, vpc_helper_1.AddAwsServiceEndpoint)(scope, this.vpc, [
            vpc_helper_1.ServiceEndpointTypeEnum.SECRETS_MANAGER,
            vpc_helper_1.ServiceEndpointTypeEnum.BEDROCK_RUNTIME,
        ]);
        this.setupCustomResource(databaseClusterResources, lambdaSecurityGroup, auroraPgCRPolicy);
    }
}
exports.ExistingAmazonAuroraVectorStore = ExistingAmazonAuroraVectorStore;
_a = JSII_RTTI_SYMBOL_1;
ExistingAmazonAuroraVectorStore[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.amazonaurora.ExistingAmazonAuroraVectorStore", version: "0.1.293" };
class AmazonAuroraVectorStore extends BaseAmazonAuroraVectorStore {
    /**
     * Creates an instance of AmazonAuroraVectorStore using existing Aurora Vector Store properties.
     * You need to provide your existing Aurora Vector Store properties
     * such as `databaseName`, `clusterIdentifier`, `vpc` where database is deployed,
     * `secret` containing username and password for authentication to database,
     * and `auroraSecurityGroupId` with the value of a security group id that was
     * used for the database.
     *
     * @param scope - The scope in which to define the construct.
     * @param id - The ID of the construct.
     * @param props - The properties of the existing Aurora Vector Store.
     * @returns An instance of AmazonAuroraVectorStore.
     */
    static fromExistingAuroraVectorStore(scope, id, props) {
        return new ExistingAmazonAuroraVectorStore(scope, id, props);
    }
    constructor(scope, id, props) {
        super(scope, id, props);
        const databaseClusterResources = this.createDatabaseCluster(props.postgreSQLVersion ?? exports.SupportedPostgreSQLVersions.AURORA_POSTGRESQL_V15_5, props.vpc);
        const auroraPgCRPolicy = this.createAuroraPgCRPolicy(databaseClusterResources.clusterIdentifier);
        const lambdaSecurityGroup = this.createLambdaSecurityGroup(databaseClusterResources.vpc);
        this.addIngressRuleToAuroraSecurityGroup(lambdaSecurityGroup, databaseClusterResources.auroraSecurityGroup);
        this.resourceArn = databaseClusterResources.resourceArn;
        this.credentialsSecretArn = databaseClusterResources.secret.secretArn;
        this.vpc = databaseClusterResources.vpc;
        (0, vpc_helper_1.AddAwsServiceEndpoint)(scope, this.vpc, [
            vpc_helper_1.ServiceEndpointTypeEnum.SECRETS_MANAGER,
            vpc_helper_1.ServiceEndpointTypeEnum.BEDROCK_RUNTIME,
        ]);
        const auroraPgVector = this.setupCustomResource(databaseClusterResources, lambdaSecurityGroup, auroraPgCRPolicy);
        auroraPgVector.node.addDependency(databaseClusterResources.auroraCluster);
    }
    createDatabaseCluster(postgreSQLVersion, existingVpc) {
        const vpc = (0, vpc_helper_1.buildVpc)(this, {
            existingVpc: existingVpc,
            vpcName: `${this.node.id}-vpc`,
        });
        vpc.addFlowLog('VpcFlowLog', {
            destination: ec2.FlowLogDestination.toCloudWatchLogs(),
        });
        const auroraSecurityGroup = new ec2.SecurityGroup(this, 'AuroraSecurityGroup', {
            vpc,
            securityGroupName: 'aurora-security-group',
            description: 'Security group for access to Aurora from Lambda',
        });
        const auroraCluster = new rds.DatabaseCluster(this, 'AuroraCluster', {
            engine: rds.DatabaseClusterEngine.auroraPostgres({
                version: postgreSQLVersion,
            }),
            credentials: rds.Credentials.fromGeneratedSecret('postgres'),
            clusterIdentifier: `aurora-serverless-vector-cluster-${cdk.Stack.of(this).account}`,
            defaultDatabaseName: this.databaseName,
            vpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_ISOLATED },
            securityGroups: [auroraSecurityGroup],
            iamAuthentication: true,
            storageEncrypted: true,
            serverlessV2MinCapacity: 0.5,
            serverlessV2MaxCapacity: 4,
            writer: rds.ClusterInstance.serverlessV2('AuroraServerlessWriter'),
            readers: [rds.ClusterInstance.serverlessV2('AuroraServerlessReader', { scaleWithWriter: true })],
            removalPolicy: cdk.RemovalPolicy.DESTROY,
        });
        const resourceArn = cdk.Stack.of(this).formatArn({
            service: 'rds',
            resource: 'cluster',
            resourceName: auroraCluster.clusterIdentifier,
            arnFormat: cdk.ArnFormat.COLON_RESOURCE_NAME,
        });
        auroraCluster.addRotationSingleUser();
        const cfnDbCluster = auroraCluster.node.defaultChild;
        cfnDbCluster.addOverride('Properties.EnableHttpEndpoint', true);
        cdk_nag_1.NagSuppressions.addResourceSuppressions(auroraCluster, [
            {
                id: 'AwsSolutions-RDS10',
                reason: 'Deletion protection is disabled to make sure a customer can stop ' +
                    'incurring charges if they want to delete the construct.',
            },
        ], true);
        return {
            vpc,
            auroraCluster,
            resourceArn,
            secret: auroraCluster.secret,
            auroraSecurityGroup,
            clusterIdentifier: auroraCluster.clusterIdentifier,
        };
    }
}
exports.AmazonAuroraVectorStore = AmazonAuroraVectorStore;
_b = JSII_RTTI_SYMBOL_1;
AmazonAuroraVectorStore[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.amazonaurora.AmazonAuroraVectorStore", version: "0.1.293" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVyb3JhLXZlY3Rvci1zdG9yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jZGstbGliL2FtYXpvbmF1cm9yYS9hdXJvcmEtdmVjdG9yLXN0b3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCw2QkFBNkI7QUFDN0IsbUNBQW1DO0FBQ25DLDJDQUEyQztBQUMzQywyQ0FBMkM7QUFDM0MsMkNBQTJDO0FBRTNDLHFDQUEwQztBQUMxQywyQ0FBdUM7QUFDdkMsMEdBQW1HO0FBQ25HLHNEQUFvRTtBQUNwRSxnRUFBMkc7QUFFM0c7O0dBRUc7QUFDVSxRQUFBLDJCQUEyQixHQUFHO0lBQ3pDLHdCQUF3QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxTQUFTO0lBQ25FLHdCQUF3QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxTQUFTO0lBQ25FLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0NBQ3pELENBQUM7QUE2SVg7OztHQUdHO0FBQ0gsTUFBZSwyQkFBNEIsU0FBUSxzQkFBUztJQTJDMUQsWUFD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RUFDSixtRUFBbUU7b0JBQ25FLHlEQUF5RDthQUM1RDtTQUNGLEVBQ0QsSUFBSSxDQUNMLENBQUM7UUFFRixPQUFPO1lBQ0wsR0FBRztZQUNILGFBQWE7WUFDYixXQUFXO1lBQ1gsTUFBTSxFQUFFLGFBQWEsQ0FBQyxNQUFPO1lBQzdCLG1CQUFtQjtZQUNuQixpQkFBaUIsRUFBRSxhQUFhLENBQUMsaUJBQWlCO1NBQ25ELENBQUM7SUFDSixDQUFDOztBQW5JSCwwREFvSUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCAqIGFzIGVjMiBmcm9tICdhd3MtY2RrLWxpYi9hd3MtZWMyJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIHJkcyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtcmRzJztcbmltcG9ydCAqIGFzIHNlY3JldHNtYW5hZ2VyIGZyb20gJ2F3cy1jZGstbGliL2F3cy1zZWNyZXRzbWFuYWdlcic7XG5pbXBvcnQgeyBOYWdTdXBwcmVzc2lvbnMgfSBmcm9tICdjZGstbmFnJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgYnVpbGRDdXN0b21SZXNvdXJjZVByb3ZpZGVyIH0gZnJvbSAnLi4vLi4vY29tbW9uL2hlbHBlcnMvY3VzdG9tLXJlc291cmNlLXByb3ZpZGVyLWhlbHBlcic7XG5pbXBvcnQgeyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyIH0gZnJvbSAnLi4vLi4vY29tbW9uL2hlbHBlcnMvdXRpbHMnO1xuaW1wb3J0IHsgQWRkQXdzU2VydmljZUVuZHBvaW50LCBidWlsZFZwYywgU2VydmljZUVuZHBvaW50VHlwZUVudW0gfSBmcm9tICcuLi8uLi9jb21tb24vaGVscGVycy92cGMtaGVscGVyJztcblxuLyoqXG4gKiBMaXN0IG9mIHN1cHBvcnRlZCB2ZXJzaW9ucyBvZiBQb3N0Z3JlU1FMIGZvciBBdXJvcmEgY2x1c3Rlci5cbiAqL1xuZXhwb3J0IGNvbnN0IFN1cHBvcnRlZFBvc3RncmVTUUxWZXJzaW9ucyA9IHtcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjEyXzE2OiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xMl8xNixcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjEzXzEyOiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xM18xMixcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjE0Xzk6IHJkcy5BdXJvcmFQb3N0Z3Jlc0VuZ2luZVZlcnNpb24uVkVSXzE0XzksXG4gIEFVUk9SQV9QT1NUR1JFU1FMX1YxNV80OiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xNV80LFxuICBBVVJPUkFfUE9TVEdSRVNRTF9WMTVfNTogcmRzLkF1cm9yYVBvc3RncmVzRW5naW5lVmVyc2lvbi5WRVJfMTVfNSxcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjE1XzY6IHJkcy5BdXJvcmFQb3N0Z3Jlc0VuZ2luZVZlcnNpb24uVkVSXzE1XzYsXG4gIEFVUk9SQV9QT1NUR1JFU1FMX1YxNV83OiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xNV83LFxuICBBVVJPUkFfUE9TVEdSRVNRTF9WMTVfODogcmRzLkF1cm9yYVBvc3RncmVzRW5naW5lVmVyc2lvbi5WRVJfMTVfOCxcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjE2XzE6IHJkcy5BdXJvcmFQb3N0Z3Jlc0VuZ2luZVZlcnNpb24uVkVSXzE2XzEsXG4gIEFVUk9SQV9QT1NUR1JFU1FMX1YxNl8yOiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xNl8yLFxuICBBVVJPUkFfUE9TVEdSRVNRTF9WMTZfMzogcmRzLkF1cm9yYVBvc3RncmVzRW5naW5lVmVyc2lvbi5WRVJfMTZfMyxcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCB0eXBlIFN1cHBvcnRlZFBvc3RncmVTUUxWZXJzaW9ucyA9XG4gICh0eXBlb2YgU3VwcG9ydGVkUG9zdGdyZVNRTFZlcnNpb25zKVtrZXlvZiB0eXBlb2YgU3VwcG9ydGVkUG9zdGdyZVNRTFZlcnNpb25zXTtcblxuLyoqXG4gKiBCYXNlIHByb3BlcnRpZXMgZm9yIGFuIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQmFzZUF1cm9yYVZlY3RvclN0b3JlUHJvcHMge1xuICAvKipcbiAgICogVGhlIHNjaGVtYSBuYW1lIGZvciB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHJlYWRvbmx5IHNjaGVtYU5hbWU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWVsZCBuYW1lIGZvciB0aGUgdmVjdG9yIGNvbHVtbiBpbiB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHJlYWRvbmx5IHZlY3RvckZpZWxkPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgbmFtZSBmb3IgdGhlIHRleHQgY29sdW1uIGluIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICAgKi9cbiAgcmVhZG9ubHkgdGV4dEZpZWxkPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgbmFtZSBmb3IgdGhlIG1ldGFkYXRhIGNvbHVtbiBpbiB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHJlYWRvbmx5IG1ldGFkYXRhRmllbGQ/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSB0YWJsZSBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICByZWFkb25seSB0YWJsZU5hbWU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBwcmltYXJ5IGtleSBmaWVsZCBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUgdGFibGUuXG4gICAqL1xuICByZWFkb25seSBwcmltYXJ5S2V5RmllbGQ/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBlbWJlZGRpbmdzIG1vZGVsIGRpbWVuc2lvbiB1c2VkIGZvciB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICogVGhlIHZlY3RvciBkaW1lbnNpb25zIG9mIHRoZSBtb2RlbCBtdXN0IG1hdGNoIHRoZSBkaW1lbnNpb25zXG4gICAqIHVzZWQgaW4gdGhlIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LlxuICAgKi9cbiAgcmVhZG9ubHkgZW1iZWRkaW5nc01vZGVsVmVjdG9yRGltZW5zaW9uOiBudW1iZXI7XG59XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgY29uZmlndXJpbmcgYW4gQW1hem9uIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVQcm9wcyBleHRlbmRzIEJhc2VBdXJvcmFWZWN0b3JTdG9yZVByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBkYXRhYmFzZSBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICByZWFkb25seSBkYXRhYmFzZU5hbWU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSB2ZXJzaW9uIG9mIFBvc3RncmVTUUwgdG8gdXNlIGZvciB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICogQnkgZGVmYXVsdCwgdGhlIGxhdGVzdCBzdXBwb3J0ZWQgdmVyc2lvbiB3aWxsIGJlIHVzZWQuXG4gICAqL1xuICByZWFkb25seSBwb3N0Z3JlU1FMVmVyc2lvbj86IFN1cHBvcnRlZFBvc3RncmVTUUxWZXJzaW9ucztcblxuICAvKipcbiAgICogVXNlcidzIFZQQyBpbiB3aGljaCB0aGV5IHdhbnQgdG8gZGVwbG95IEF1cm9yYSBEYXRhYmFzZS5cbiAgICovXG4gIHJlYWRvbmx5IHZwYz86IGVjMi5JVnBjO1xufVxuXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGFuIGV4aXN0aW5nIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gKiBZb3UgZGF0YWJhc2UgbXVzdCBoYXZlIFRDUC9JUCBwb3J0IHRoYXQgdGhlXG4gKiBkYXRhYmFzZSB3aWxsIHVzZSBmb3IgYXBwbGljYXRpb24gY29ubmVjdGlvbnNcbiAqIHNldCB1cCBmb3IgYDU0MzJgLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVQcm9wcyBleHRlbmRzIEJhc2VBdXJvcmFWZWN0b3JTdG9yZVByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBkYXRhYmFzZSBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICByZWFkb25seSBkYXRhYmFzZU5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHVuaXF1ZSBjbHVzdGVyIGlkZW50aWZpZXIgb2YgeW91ciBBdXJvcmEgUkRTIGNsdXN0ZXIuXG4gICAqL1xuICByZWFkb25seSBjbHVzdGVySWRlbnRpZmllcjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgVlBDIGluIHdoaWNoIHRoZSBleGlzdGluZyBBdXJvcmEgVmVjdG9yIFN0b3JlIGlzIGxvY2F0ZWQuXG4gICAqL1xuICByZWFkb25seSB2cGM6IGVjMi5JVnBjO1xuXG4gIC8qKlxuICAgKiBUaGUgc2VjcmV0IGNvbnRhaW5pbmcgdGhlIGRhdGFiYXNlIGNyZWRlbnRpYWxzLlxuICAgKiBUaGUgc2VjcmV0IG11c3QgY29udGFpbiBgaG9zdGAsIGBwb3J0YCwgYHVzZXJuYW1lYCxcbiAgICogYHBhc3N3b3JkYCBhbmQgYGRibmFtZWAgdmFsdWVzLlxuICAgKi9cbiAgcmVhZG9ubHkgc2VjcmV0OiBzZWNyZXRzbWFuYWdlci5JU2VjcmV0O1xuXG4gIC8qKlxuICAgKiBUaGUgaWQgb2YgdGhlIHNlY3VyaXR5IGdyb3VwIGFzc29jaWF0ZWQgd2l0aCB0aGUgUkRTIEF1cm9yYSBpbnN0YW5jZS5cbiAgICogVGhpcyBzZWN1cml0eSBncm91cCBhbGxvd3MgYWNjZXNzIHRvIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlIGZyb20gTGFtYmRhJ3NcbiAgICogY3VzdG9tIHJlc291cmNlIHJ1bm5pbmcgcGdWZWN0b3IgU1FMIGNvbW1hbmRzLlxuICAgKi9cbiAgcmVhZG9ubHkgYXVyb3JhU2VjdXJpdHlHcm91cElkOiBzdHJpbmc7XG59XG5cbi8qKlxuICogSW50ZXJmYWNlIHJlcHJlc2VudGluZyB0aGUgcmVzb3VyY2VzIHJlcXVpcmVkIGZvciBhIGRhdGFiYXNlIGNsdXN0ZXIuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzIHtcbiAgLyoqXG4gICAqIFRoZSBBbWF6b24gQXVyb3JhIFJEUyBjbHVzdGVyLlxuICAgKi9cbiAgcmVhZG9ubHkgYXVyb3JhQ2x1c3Rlcj86IHJkcy5EYXRhYmFzZUNsdXN0ZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgeW91ciBleGlzdGluZyBBbWF6b24gQXVyb3JhIERCIGNsdXN0ZXIuXG4gICAqL1xuICByZWFkb25seSByZXNvdXJjZUFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGNsdXN0ZXIgaWRlbnRpZmllciBvZiB0aGUgQXVyb3JhIFJEUyBjbHVzdGVyLlxuICAgKi9cbiAgcmVhZG9ubHkgY2x1c3RlcklkZW50aWZpZXI6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIFZQQyBpbiB3aGljaCB0aGUgZGF0YWJhc2UgY2x1c3RlciBpcyBsb2NhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgdnBjOiBlYzIuSVZwYztcblxuICAvKipcbiAgICogVGhlIHNlY3JldCBjb250YWluaW5nIHRoZSBkYXRhYmFzZSBjcmVkZW50aWFscy5cbiAgICogVGhlIHNlY3JldCBtdXN0IGNvbnRhaW4gYHVzZXJuYW1lYCBhbmQgYHBhc3N3b3JkYCB2YWx1ZXMuXG4gICAqL1xuICByZWFkb25seSBzZWNyZXQ6IHNlY3JldHNtYW5hZ2VyLklTZWNyZXQ7XG5cbiAgLyoqXG4gICAqIFRoZSBzZWN1cml0eSBncm91cCBhc3NvY2lhdGVkIHdpdGggdGhlIEF1cm9yYSBjbHVzdGVyLlxuICAgKi9cbiAgcmVhZG9ubHkgYXVyb3JhU2VjdXJpdHlHcm91cDogZWMyLlNlY3VyaXR5R3JvdXA7XG59XG5cbi8qKlxuICogQmFzZSBjbGFzcyBmb3IgQW1hem9uIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gKiBIYW5kbGVzIGJvdGggdGhlIGNyZWF0aW9uIG9mIGEgbmV3IEF1cm9yYSBWZWN0b3IgU3RvcmUgb3IgdGhlIHVzYWdlIG9mIGFuIGV4aXN0aW5nIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gKi9cbmFic3RyYWN0IGNsYXNzIEJhc2VBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSBleHRlbmRzIENvbnN0cnVjdCB7XG4gIC8qKlxuICAgKiBUaGUgc2NoZW1hIG5hbWUgZm9yIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHNjaGVtYU5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZpZWxkIG5hbWUgZm9yIHRoZSB2ZWN0b3IgY29sdW1uIGluIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHZlY3RvckZpZWxkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWVsZCBuYW1lIGZvciB0aGUgdGV4dCBjb2x1bW4gaW4gdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdGV4dEZpZWxkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWVsZCBuYW1lIGZvciB0aGUgbWV0YWRhdGEgY29sdW1uIGluIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IG1ldGFkYXRhRmllbGQ6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGRhdGFiYXNlIGZvciB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkYXRhYmFzZU5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIHRhYmxlIGZvciB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB0YWJsZU5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHByaW1hcnkga2V5IGZpZWxkIGZvciB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZSB0YWJsZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBwcmltYXJ5S2V5RmllbGQ6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGVtYmVkZGluZ3MgbW9kZWwgZGltZW5zaW9uIHVzZWQgZm9yIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICAgKiBUaGUgdmVjdG9yIGRpbWVuc2lvbnMgb2YgdGhlIG1vZGVsIG11c3QgbWF0Y2ggdGhlIGRpbWVuc2lvbnNcbiAgICogdXNlZCBpbiB0aGUgS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuXG4gICAqL1xuICByZWFkb25seSBlbWJlZGRpbmdzTW9kZWxWZWN0b3JEaW1lbnNpb246IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIGlkOiBzdHJpbmcsXG4gICAgcHJvcHM6IEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlUHJvcHMgfCBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlUHJvcHMsXG4gICkge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICAvKipcbiAgICAgKiBTZXR1cCBkYXRhYmFzZU5hbWUgYmFzZWQgb24gaWYgaXQgaXMgcHJvdmlkZWQgaW4gdGhlIHByb3BzIG9yIG5vdFxuICAgICAqIGFuZCBiYXNlZCBvbiB3aGV0aGVyIGl0IGlzIGFuIGV4aXN0aW5nIEF1cm9yYSBWZWN0b3IgU3RvcmUgb3Igbm90LlxuICAgICAqL1xuICAgIHRoaXMuZGF0YWJhc2VOYW1lID0gJ2NsdXN0ZXJJZGVudGlmaWVyJyBpbiBwcm9wcyA/IHByb3BzLmRhdGFiYXNlTmFtZSA6IHByb3BzLmRhdGFiYXNlTmFtZSA/PyAnYmVkcm9ja192ZWN0b3JfZGInO1xuXG4gICAgdGhpcy5zY2hlbWFOYW1lID0gcHJvcHMuc2NoZW1hTmFtZSA/PyAnYmVkcm9ja19pbnRlZ3JhdGlvbic7XG4gICAgdGhpcy52ZWN0b3JGaWVsZCA9IHByb3BzLnZlY3RvckZpZWxkID8/ICdlbWJlZGRpbmcnO1xuICAgIHRoaXMudGV4dEZpZWxkID0gcHJvcHMudGV4dEZpZWxkID8/ICdjaHVua3MnO1xuICAgIHRoaXMubWV0YWRhdGFGaWVsZCA9IHByb3BzLm1ldGFkYXRhRmllbGQgPz8gJ21ldGFkYXRhJztcbiAgICB0aGlzLnRhYmxlTmFtZSA9IHByb3BzLnRhYmxlTmFtZSA/PyAnYmVkcm9ja19rYic7XG4gICAgdGhpcy5wcmltYXJ5S2V5RmllbGQgPSBwcm9wcy5wcmltYXJ5S2V5RmllbGQgPz8gJ2lkJztcbiAgICB0aGlzLmVtYmVkZGluZ3NNb2RlbFZlY3RvckRpbWVuc2lvbiA9IHByb3BzLmVtYmVkZGluZ3NNb2RlbFZlY3RvckRpbWVuc2lvbjtcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVBdXJvcmFQZ0NSUG9saWN5KGNsdXN0ZXJJZGVudGlmaWVyOiBzdHJpbmcpOiBpYW0uTWFuYWdlZFBvbGljeSB7XG4gICAgY29uc3QgY3JQb2xpY3kgPSBuZXcgaWFtLk1hbmFnZWRQb2xpY3kodGhpcywgJ0F1cm9yYVBnUG9saWN5Jywge1xuICAgICAgbWFuYWdlZFBvbGljeU5hbWU6IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ0F1cm9yYVBnUG9saWN5Jywge1xuICAgICAgICBtYXhMZW5ndGg6IDMyLFxuICAgICAgICBsb3dlcjogdHJ1ZSxcbiAgICAgIH0pLFxuICAgICAgc3RhdGVtZW50czogW1xuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgJ2VjMjpEZXNjcmliZUluc3RhbmNlcycsXG4gICAgICAgICAgICAnZWMyOkNyZWF0ZU5ldHdvcmtJbnRlcmZhY2UnLFxuICAgICAgICAgICAgJ2VjMjpBdHRhY2hOZXR3b3JrSW50ZXJmYWNlJyxcbiAgICAgICAgICAgICdlYzI6RGVzY3JpYmVOZXR3b3JrSW50ZXJmYWNlcycsXG4gICAgICAgICAgICAnYXV0b3NjYWxpbmc6Q29tcGxldGVMaWZlY3ljbGVBY3Rpb24nLFxuICAgICAgICAgICAgJ2VjMjpEZWxldGVOZXR3b3JrSW50ZXJmYWNlJyxcbiAgICAgICAgICBdLFxuICAgICAgICAgIHJlc291cmNlczogWycqJ10sXG4gICAgICAgIH0pLFxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogWydyZHM6RGVzY3JpYmVEQkNsdXN0ZXJzJ10sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbXG4gICAgICAgICAgICBjZGsuU3RhY2sub2YodGhpcykuZm9ybWF0QXJuKHtcbiAgICAgICAgICAgICAgc2VydmljZTogJ3JkcycsXG4gICAgICAgICAgICAgIHJlc291cmNlOiAnY2x1c3RlcicsXG4gICAgICAgICAgICAgIHJlc291cmNlTmFtZTogY2x1c3RlcklkZW50aWZpZXIsXG4gICAgICAgICAgICAgIGFybkZvcm1hdDogY2RrLkFybkZvcm1hdC5DT0xPTl9SRVNPVVJDRV9OQU1FLFxuICAgICAgICAgICAgICBhY2NvdW50OiBjZGsuU3RhY2sub2YodGhpcykuYWNjb3VudCxcbiAgICAgICAgICAgICAgcmVnaW9uOiBjZGsuU3RhY2sub2YodGhpcykucmVnaW9uLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgXSxcbiAgICAgICAgfSksXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgTmFnU3VwcHJlc3Npb25zLmFkZFJlc291cmNlU3VwcHJlc3Npb25zKFxuICAgICAgY3JQb2xpY3ksXG4gICAgICBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ0F3c1NvbHV0aW9ucy1JQU00JyxcbiAgICAgICAgICByZWFzb246XG4gICAgICAgICAgICAnVGhlIEFXU0xhbWJkYUJhc2ljRXhlY3V0aW9uUm9sZSBtYW5hZ2VkIHBvbGljeSBpcyByZXF1aXJlZCBmb3IgJyArXG4gICAgICAgICAgICAndGhlIExhbWJkYSBmdW5jdGlvbiB0byB3cml0ZSBsb2dzIHRvIENsb3VkV2F0Y2guJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnQXdzU29sdXRpb25zLUlBTTUnLFxuICAgICAgICAgIHJlYXNvbjpcbiAgICAgICAgICAgICdUaGlzIHBvbGljeSBpcyByZXF1aXJlZCB0byBhbGxvdyB0aGUgY3VzdG9tIHJlc291cmNlIHRvIGNyZWF0ZSBhICcgK1xuICAgICAgICAgICAgJ25ldHdvcmsgaW50ZXJmYWNlIGZvciB0aGUgQXVyb3JhIGNsdXN0ZXIgYW5kIGl0IGhhcyB0byBiZSB3aWxkY2FyZC4nLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIHRydWUsXG4gICAgKTtcblxuICAgIHJldHVybiBjclBvbGljeTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZW5lcmF0ZVJlc291cmNlQXJuKGNsdXN0ZXJJZGVudGlmaWVyOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBjZGsuU3RhY2sub2YodGhpcykuZm9ybWF0QXJuKHtcbiAgICAgIHNlcnZpY2U6ICdyZHMnLFxuICAgICAgcmVzb3VyY2U6ICdjbHVzdGVyJyxcbiAgICAgIHJlc291cmNlTmFtZTogY2x1c3RlcklkZW50aWZpZXIsXG4gICAgICByZWdpb246IGNkay5TdGFjay5vZih0aGlzKS5yZWdpb24sXG4gICAgICBhY2NvdW50OiBjZGsuU3RhY2sub2YodGhpcykuYWNjb3VudCxcbiAgICAgIGFybkZvcm1hdDogY2RrLkFybkZvcm1hdC5DT0xPTl9SRVNPVVJDRV9OQU1FLFxuICAgIH0pO1xuICB9XG5cbiAgcHJvdGVjdGVkIHNldHVwRGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzKFxuICAgIHZwYzogZWMyLklWcGMsXG4gICAgc2VjcmV0OiBzZWNyZXRzbWFuYWdlci5JU2VjcmV0LFxuICAgIGNsdXN0ZXJJZGVudGlmaWVyOiBzdHJpbmcsXG4gICAgYXVyb3JhU2VjdXJpdHlHcm91cElkOiBzdHJpbmcsXG4gICk6IERhdGFiYXNlQ2x1c3RlclJlc291cmNlcyB7XG4gICAgY29uc3QgcmVzb3VyY2VBcm4gPSB0aGlzLmdlbmVyYXRlUmVzb3VyY2VBcm4oY2x1c3RlcklkZW50aWZpZXIpO1xuICAgIGNvbnN0IGF1cm9yYVNlY3VyaXR5R3JvdXAgPSBlYzIuU2VjdXJpdHlHcm91cC5mcm9tTG9va3VwQnlJZChcbiAgICAgIHRoaXMsXG4gICAgICAnRXhpc3RpbmdTRycsXG4gICAgICBhdXJvcmFTZWN1cml0eUdyb3VwSWQsXG4gICAgKSBhcyBlYzIuU2VjdXJpdHlHcm91cDtcblxuICAgIHJldHVybiB7XG4gICAgICB2cGMsXG4gICAgICBzZWNyZXQsXG4gICAgICByZXNvdXJjZUFybixcbiAgICAgIGF1cm9yYVNlY3VyaXR5R3JvdXAsXG4gICAgICBjbHVzdGVySWRlbnRpZmllcixcbiAgICB9O1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZUxhbWJkYVNlY3VyaXR5R3JvdXAodnBjOiBlYzIuSVZwYyk6IGVjMi5TZWN1cml0eUdyb3VwIHtcbiAgICByZXR1cm4gbmV3IGVjMi5TZWN1cml0eUdyb3VwKHRoaXMsICdMYW1iZGFTZWN1cml0eUdyb3VwJywge1xuICAgICAgdnBjLFxuICAgICAgc2VjdXJpdHlHcm91cE5hbWU6ICdsYW1iZGEtc2VjdXJpdHktZ3JvdXAnLFxuICAgICAgZGVzY3JpcHRpb246ICdTZWN1cml0eSBncm91cCBmb3IgTGFtYmRhIGFjY2VzcyB0byBBdXJvcmEnLFxuICAgIH0pO1xuICB9XG5cbiAgcHJvdGVjdGVkIGFkZEluZ3Jlc3NSdWxlVG9BdXJvcmFTZWN1cml0eUdyb3VwKFxuICAgIGxhbWJkYVNlY3VyaXR5R3JvdXA6IGVjMi5TZWN1cml0eUdyb3VwLFxuICAgIGF1cm9yYVNlY3VyaXR5R3JvdXA6IGVjMi5TZWN1cml0eUdyb3VwLFxuICApIHtcbiAgICBhdXJvcmFTZWN1cml0eUdyb3VwLmFkZEluZ3Jlc3NSdWxlKFxuICAgICAgbGFtYmRhU2VjdXJpdHlHcm91cCxcbiAgICAgIGVjMi5Qb3J0LnRjcCg1NDMyKSxcbiAgICAgICdBbGxvdyBQb3N0Z3JlU1FMIGFjY2VzcyBmcm9tIExhbWJkYSBzZWN1cml0eSBncm91cCcsXG4gICAgKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBzZXR1cEN1c3RvbVJlc291cmNlKFxuICAgIGRhdGFiYXNlQ2x1c3RlclJlc291cmNlczogRGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLFxuICAgIGxhbWJkYVNlY3VyaXR5R3JvdXA6IGVjMi5TZWN1cml0eUdyb3VwLFxuICAgIGF1cm9yYVBnQ1JQb2xpY3k6IGlhbS5NYW5hZ2VkUG9saWN5LFxuICApOiBjZGsuQ3VzdG9tUmVzb3VyY2Uge1xuICAgIGNvbnN0IGN1c3RvbVJlc291cmNlID0gYnVpbGRDdXN0b21SZXNvdXJjZVByb3ZpZGVyKHtcbiAgICAgIHByb3ZpZGVyTmFtZTogJ0FtYXpvbkF1cm9yYVBnVmVjdG9yQ1JQcm92aWRlcicsXG4gICAgICB2cGM6IGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy52cGMsXG4gICAgICBzZWN1cml0eUdyb3VwOiBsYW1iZGFTZWN1cml0eUdyb3VwLFxuICAgICAgY29kZVBhdGg6IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi8uLi8uLi9sYW1iZGEvYW1hem9uLWF1cm9yYS1wZ3ZlY3Rvci1jdXN0b20tcmVzb3VyY2VzJyksXG4gICAgICBoYW5kbGVyOiAnY3VzdG9tX3Jlc291cmNlcy5vbl9ldmVudCcsXG4gICAgICBydW50aW1lOiBjZGsuYXdzX2xhbWJkYS5SdW50aW1lLlBZVEhPTl8zXzEyLFxuICAgIH0pO1xuXG4gICAgY29uc3QgY3JQcm92aWRlciA9IGN1c3RvbVJlc291cmNlLmdldFByb3ZpZGVyKHRoaXMpO1xuICAgIGNyUHJvdmlkZXIucm9sZS5hZGRNYW5hZ2VkUG9saWN5KGF1cm9yYVBnQ1JQb2xpY3kpO1xuICAgIGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy5zZWNyZXQuZ3JhbnRSZWFkKGNyUHJvdmlkZXIucm9sZSk7XG5cbiAgICBjb25zdCBhdXJvcmFQZ1ZlY3RvciA9IG5ldyBjZGsuQ3VzdG9tUmVzb3VyY2UodGhpcywgJ0F1cm9yYVBnVmVjdG9yJywge1xuICAgICAgcmVzb3VyY2VUeXBlOiAnQ3VzdG9tOjpBbWF6b25BdXJvcmFQZ1ZlY3RvcicsXG4gICAgICBzZXJ2aWNlVG9rZW46IGNyUHJvdmlkZXIuc2VydmljZVRva2VuLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICBTZWNyZXROYW1lOiBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuc2VjcmV0LnNlY3JldE5hbWUgfHwgJycsXG4gICAgICAgIENsdXN0ZXJJZGVudGlmaWVyOiBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuY2x1c3RlcklkZW50aWZpZXIsXG4gICAgICAgIERhdGFiYXNlTmFtZTogdGhpcy5kYXRhYmFzZU5hbWUsXG4gICAgICAgIFRhYmxlTmFtZTogdGhpcy50YWJsZU5hbWUsXG4gICAgICAgIFZlY3RvckRpbWVuc2lvbnM6IHRoaXMuZW1iZWRkaW5nc01vZGVsVmVjdG9yRGltZW5zaW9uLFxuICAgICAgICBQcmltYXJ5S2V5RmllbGQ6IHRoaXMucHJpbWFyeUtleUZpZWxkLFxuICAgICAgICBTY2hlbWFOYW1lOiB0aGlzLnNjaGVtYU5hbWUsXG4gICAgICAgIFZlY3RvckZpZWxkOiB0aGlzLnZlY3RvckZpZWxkLFxuICAgICAgICBUZXh0RmllbGQ6IHRoaXMudGV4dEZpZWxkLFxuICAgICAgICBNZXRhZGF0YUZpZWxkOiB0aGlzLm1ldGFkYXRhRmllbGQsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIGF1cm9yYVBnVmVjdG9yLm5vZGUuYWRkRGVwZW5kZW5jeShhdXJvcmFQZ0NSUG9saWN5KTtcblxuICAgIHJldHVybiBhdXJvcmFQZ1ZlY3RvcjtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSBleHRlbmRzIEJhc2VBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHlvdXIgQW1hem9uIEF1cm9yYSBEQiBjbHVzdGVyLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHJlc291cmNlQXJuOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBTZWNyZXQgQVJOIG9mIHlvdXIgQW1hem9uIEF1cm9yYSBEQiBjbHVzdGVyLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGNyZWRlbnRpYWxzU2VjcmV0QXJuOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBWUEMgb2YgeW91ciBBbWF6b24gQXVyb3JhIERCIGNsdXN0ZXIuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdnBjOiBlYzIuSVZwYztcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XG5cbiAgICBjb25zdCBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMgPSB0aGlzLnNldHVwRGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzKFxuICAgICAgcHJvcHMudnBjLFxuICAgICAgcHJvcHMuc2VjcmV0LFxuICAgICAgcHJvcHMuY2x1c3RlcklkZW50aWZpZXIsXG4gICAgICBwcm9wcy5hdXJvcmFTZWN1cml0eUdyb3VwSWQsXG4gICAgKTtcblxuICAgIGNvbnN0IGF1cm9yYVBnQ1JQb2xpY3kgPSB0aGlzLmNyZWF0ZUF1cm9yYVBnQ1JQb2xpY3koZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLmNsdXN0ZXJJZGVudGlmaWVyKTtcbiAgICBjb25zdCBsYW1iZGFTZWN1cml0eUdyb3VwID0gdGhpcy5jcmVhdGVMYW1iZGFTZWN1cml0eUdyb3VwKGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy52cGMpO1xuICAgIHRoaXMuYWRkSW5ncmVzc1J1bGVUb0F1cm9yYVNlY3VyaXR5R3JvdXAobGFtYmRhU2VjdXJpdHlHcm91cCwgZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLmF1cm9yYVNlY3VyaXR5R3JvdXApO1xuXG4gICAgdGhpcy5yZXNvdXJjZUFybiA9IHRoaXMuZ2VuZXJhdGVSZXNvdXJjZUFybihkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuY2x1c3RlcklkZW50aWZpZXIpO1xuICAgIHRoaXMuY3JlZGVudGlhbHNTZWNyZXRBcm4gPSBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuc2VjcmV0LnNlY3JldEFybjtcbiAgICB0aGlzLnZwYyA9IGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy52cGM7XG5cbiAgICBBZGRBd3NTZXJ2aWNlRW5kcG9pbnQoc2NvcGUsIHRoaXMudnBjLCBbXG4gICAgICBTZXJ2aWNlRW5kcG9pbnRUeXBlRW51bS5TRUNSRVRTX01BTkFHRVIsXG4gICAgICBTZXJ2aWNlRW5kcG9pbnRUeXBlRW51bS5CRURST0NLX1JVTlRJTUUsXG4gICAgXSk7XG5cbiAgICB0aGlzLnNldHVwQ3VzdG9tUmVzb3VyY2UoZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLCBsYW1iZGFTZWN1cml0eUdyb3VwLCBhdXJvcmFQZ0NSUG9saWN5KTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgZXh0ZW5kcyBCYXNlQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUge1xuICAvKipcbiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB1c2luZyBleGlzdGluZyBBdXJvcmEgVmVjdG9yIFN0b3JlIHByb3BlcnRpZXMuXG4gICAqIFlvdSBuZWVkIHRvIHByb3ZpZGUgeW91ciBleGlzdGluZyBBdXJvcmEgVmVjdG9yIFN0b3JlIHByb3BlcnRpZXNcbiAgICogc3VjaCBhcyBgZGF0YWJhc2VOYW1lYCwgYGNsdXN0ZXJJZGVudGlmaWVyYCwgYHZwY2Agd2hlcmUgZGF0YWJhc2UgaXMgZGVwbG95ZWQsXG4gICAqIGBzZWNyZXRgIGNvbnRhaW5pbmcgdXNlcm5hbWUgYW5kIHBhc3N3b3JkIGZvciBhdXRoZW50aWNhdGlvbiB0byBkYXRhYmFzZSxcbiAgICogYW5kIGBhdXJvcmFTZWN1cml0eUdyb3VwSWRgIHdpdGggdGhlIHZhbHVlIG9mIGEgc2VjdXJpdHkgZ3JvdXAgaWQgdGhhdCB3YXNcbiAgICogdXNlZCBmb3IgdGhlIGRhdGFiYXNlLlxuICAgKlxuICAgKiBAcGFyYW0gc2NvcGUgLSBUaGUgc2NvcGUgaW4gd2hpY2ggdG8gZGVmaW5lIHRoZSBjb25zdHJ1Y3QuXG4gICAqIEBwYXJhbSBpZCAtIFRoZSBJRCBvZiB0aGUgY29uc3RydWN0LlxuICAgKiBAcGFyYW0gcHJvcHMgLSBUaGUgcHJvcGVydGllcyBvZiB0aGUgZXhpc3RpbmcgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICogQHJldHVybnMgQW4gaW5zdGFuY2Ugb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGZyb21FeGlzdGluZ0F1cm9yYVZlY3RvclN0b3JlKFxuICAgIHNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgaWQ6IHN0cmluZyxcbiAgICBwcm9wczogRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVByb3BzLFxuICApOiBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlIHtcbiAgICByZXR1cm4gbmV3IEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUoc2NvcGUsIGlkLCBwcm9wcyk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIEFSTiBvZiB5b3VyIEFtYXpvbiBBdXJvcmEgREIgY2x1c3Rlci5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSByZXNvdXJjZUFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgU2VjcmV0IEFSTiBvZiB5b3VyIEFtYXpvbiBBdXJvcmEgREIgY2x1c3Rlci5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjcmVkZW50aWFsc1NlY3JldEFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgVlBDIG9mIHlvdXIgQW1hem9uIEF1cm9yYSBEQiBjbHVzdGVyLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHZwYzogZWMyLklWcGM7XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcblxuICAgIGNvbnN0IGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcyA9IHRoaXMuY3JlYXRlRGF0YWJhc2VDbHVzdGVyKFxuICAgICAgcHJvcHMucG9zdGdyZVNRTFZlcnNpb24gPz8gU3VwcG9ydGVkUG9zdGdyZVNRTFZlcnNpb25zLkFVUk9SQV9QT1NUR1JFU1FMX1YxNV81LFxuICAgICAgcHJvcHMudnBjLFxuICAgICk7XG4gICAgY29uc3QgYXVyb3JhUGdDUlBvbGljeSA9IHRoaXMuY3JlYXRlQXVyb3JhUGdDUlBvbGljeShkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuY2x1c3RlcklkZW50aWZpZXIpO1xuICAgIGNvbnN0IGxhbWJkYVNlY3VyaXR5R3JvdXAgPSB0aGlzLmNyZWF0ZUxhbWJkYVNlY3VyaXR5R3JvdXAoZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLnZwYyk7XG4gICAgdGhpcy5hZGRJbmdyZXNzUnVsZVRvQXVyb3JhU2VjdXJpdHlHcm91cChsYW1iZGFTZWN1cml0eUdyb3VwLCBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuYXVyb3JhU2VjdXJpdHlHcm91cCk7XG5cbiAgICB0aGlzLnJlc291cmNlQXJuID0gZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLnJlc291cmNlQXJuO1xuICAgIHRoaXMuY3JlZGVudGlhbHNTZWNyZXRBcm4gPSBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuc2VjcmV0LnNlY3JldEFybjtcbiAgICB0aGlzLnZwYyA9IGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy52cGM7XG5cbiAgICBBZGRBd3NTZXJ2aWNlRW5kcG9pbnQoc2NvcGUsIHRoaXMudnBjLCBbXG4gICAgICBTZXJ2aWNlRW5kcG9pbnRUeXBlRW51bS5TRUNSRVRTX01BTkFHRVIsXG4gICAgICBTZXJ2aWNlRW5kcG9pbnRUeXBlRW51bS5CRURST0NLX1JVTlRJTUUsXG4gICAgXSk7XG5cbiAgICBjb25zdCBhdXJvcmFQZ1ZlY3RvciA9IHRoaXMuc2V0dXBDdXN0b21SZXNvdXJjZShkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMsIGxhbWJkYVNlY3VyaXR5R3JvdXAsIGF1cm9yYVBnQ1JQb2xpY3kpO1xuXG4gICAgYXVyb3JhUGdWZWN0b3Iubm9kZS5hZGREZXBlbmRlbmN5KGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy5hdXJvcmFDbHVzdGVyISk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZURhdGFiYXNlQ2x1c3RlcihcbiAgICBwb3N0Z3JlU1FMVmVyc2lvbjogU3VwcG9ydGVkUG9zdGdyZVNRTFZlcnNpb25zLFxuICAgIGV4aXN0aW5nVnBjOiBlYzIuSVZwYyB8IHVuZGVmaW5lZCxcbiAgKTogRGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzIHtcbiAgICBjb25zdCB2cGMgPSBidWlsZFZwYyh0aGlzLCB7XG4gICAgICBleGlzdGluZ1ZwYzogZXhpc3RpbmdWcGMsXG4gICAgICB2cGNOYW1lOiBgJHt0aGlzLm5vZGUuaWR9LXZwY2AsXG4gICAgfSk7XG4gICAgdnBjLmFkZEZsb3dMb2coJ1ZwY0Zsb3dMb2cnLCB7XG4gICAgICBkZXN0aW5hdGlvbjogZWMyLkZsb3dMb2dEZXN0aW5hdGlvbi50b0Nsb3VkV2F0Y2hMb2dzKCksXG4gICAgfSk7XG5cbiAgICBjb25zdCBhdXJvcmFTZWN1cml0eUdyb3VwID0gbmV3IGVjMi5TZWN1cml0eUdyb3VwKHRoaXMsICdBdXJvcmFTZWN1cml0eUdyb3VwJywge1xuICAgICAgdnBjLFxuICAgICAgc2VjdXJpdHlHcm91cE5hbWU6ICdhdXJvcmEtc2VjdXJpdHktZ3JvdXAnLFxuICAgICAgZGVzY3JpcHRpb246ICdTZWN1cml0eSBncm91cCBmb3IgYWNjZXNzIHRvIEF1cm9yYSBmcm9tIExhbWJkYScsXG4gICAgfSk7XG5cbiAgICBjb25zdCBhdXJvcmFDbHVzdGVyID0gbmV3IHJkcy5EYXRhYmFzZUNsdXN0ZXIodGhpcywgJ0F1cm9yYUNsdXN0ZXInLCB7XG4gICAgICBlbmdpbmU6IHJkcy5EYXRhYmFzZUNsdXN0ZXJFbmdpbmUuYXVyb3JhUG9zdGdyZXMoe1xuICAgICAgICB2ZXJzaW9uOiBwb3N0Z3JlU1FMVmVyc2lvbixcbiAgICAgIH0pLFxuICAgICAgY3JlZGVudGlhbHM6IHJkcy5DcmVkZW50aWFscy5mcm9tR2VuZXJhdGVkU2VjcmV0KCdwb3N0Z3JlcycpLFxuICAgICAgY2x1c3RlcklkZW50aWZpZXI6IGBhdXJvcmEtc2VydmVybGVzcy12ZWN0b3ItY2x1c3Rlci0ke2Nkay5TdGFjay5vZih0aGlzKS5hY2NvdW50fWAsXG4gICAgICBkZWZhdWx0RGF0YWJhc2VOYW1lOiB0aGlzLmRhdGFiYXNlTmFtZSxcbiAgICAgIHZwYyxcbiAgICAgIHZwY1N1Ym5ldHM6IHsgc3VibmV0VHlwZTogZWMyLlN1Ym5ldFR5cGUuUFJJVkFURV9JU09MQVRFRCB9LFxuICAgICAgc2VjdXJpdHlHcm91cHM6IFthdXJvcmFTZWN1cml0eUdyb3VwXSxcbiAgICAgIGlhbUF1dGhlbnRpY2F0aW9uOiB0cnVlLFxuICAgICAgc3RvcmFnZUVuY3J5cHRlZDogdHJ1ZSxcbiAgICAgIHNlcnZlcmxlc3NWMk1pbkNhcGFjaXR5OiAwLjUsXG4gICAgICBzZXJ2ZXJsZXNzVjJNYXhDYXBhY2l0eTogNCxcbiAgICAgIHdyaXRlcjogcmRzLkNsdXN0ZXJJbnN0YW5jZS5zZXJ2ZXJsZXNzVjIoJ0F1cm9yYVNlcnZlcmxlc3NXcml0ZXInKSxcbiAgICAgIHJlYWRlcnM6IFtyZHMuQ2x1c3Rlckluc3RhbmNlLnNlcnZlcmxlc3NWMignQXVyb3JhU2VydmVybGVzc1JlYWRlcicsIHsgc2NhbGVXaXRoV3JpdGVyOiB0cnVlIH0pXSxcbiAgICAgIHJlbW92YWxQb2xpY3k6IGNkay5SZW1vdmFsUG9saWN5LkRFU1RST1ksXG4gICAgfSk7XG4gICAgY29uc3QgcmVzb3VyY2VBcm4gPSBjZGsuU3RhY2sub2YodGhpcykuZm9ybWF0QXJuKHtcbiAgICAgIHNlcnZpY2U6ICdyZHMnLFxuICAgICAgcmVzb3VyY2U6ICdjbHVzdGVyJyxcbiAgICAgIHJlc291cmNlTmFtZTogYXVyb3JhQ2x1c3Rlci5jbHVzdGVySWRlbnRpZmllcixcbiAgICAgIGFybkZvcm1hdDogY2RrLkFybkZvcm1hdC5DT0xPTl9SRVNPVVJDRV9OQU1FLFxuICAgIH0pO1xuXG4gICAgYXVyb3JhQ2x1c3Rlci5hZGRSb3RhdGlvblNpbmdsZVVzZXIoKTtcblxuICAgIGNvbnN0IGNmbkRiQ2x1c3RlciA9IGF1cm9yYUNsdXN0ZXIubm9kZS5kZWZhdWx0Q2hpbGQgYXMgcmRzLkNmbkRCQ2x1c3RlcjtcbiAgICBjZm5EYkNsdXN0ZXIuYWRkT3ZlcnJpZGUoJ1Byb3BlcnRpZXMuRW5hYmxlSHR0cEVuZHBvaW50JywgdHJ1ZSk7XG5cbiAgICBOYWdTdXBwcmVzc2lvbnMuYWRkUmVzb3VyY2VTdXBwcmVzc2lvbnMoXG4gICAgICBhdXJvcmFDbHVzdGVyLFxuICAgICAgW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdBd3NTb2x1dGlvbnMtUkRTMTAnLFxuICAgICAgICAgIHJlYXNvbjpcbiAgICAgICAgICAgICdEZWxldGlvbiBwcm90ZWN0aW9uIGlzIGRpc2FibGVkIHRvIG1ha2Ugc3VyZSBhIGN1c3RvbWVyIGNhbiBzdG9wICcgK1xuICAgICAgICAgICAgJ2luY3VycmluZyBjaGFyZ2VzIGlmIHRoZXkgd2FudCB0byBkZWxldGUgdGhlIGNvbnN0cnVjdC4nLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIHRydWUsXG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICB2cGMsXG4gICAgICBhdXJvcmFDbHVzdGVyLFxuICAgICAgcmVzb3VyY2VBcm4sXG4gICAgICBzZWNyZXQ6IGF1cm9yYUNsdXN0ZXIuc2VjcmV0ISxcbiAgICAgIGF1cm9yYVNlY3VyaXR5R3JvdXAsXG4gICAgICBjbHVzdGVySWRlbnRpZmllcjogYXVyb3JhQ2x1c3Rlci5jbHVzdGVySWRlbnRpZmllcixcbiAgICB9O1xuICB9XG59XG4iXX0=