"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Agent = exports.AgentBase = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const bedrock = require("aws-cdk-lib/aws-bedrock");
const iam = require("aws-cdk-lib/aws-iam");
const kms = require("aws-cdk-lib/aws-kms");
// Internal Libs
const action_group_1 = require("./action-group");
const agent_alias_1 = require("./agent-alias");
const utils_1 = require("../../../common/helpers/utils");
const validation = require("../../../common/helpers/validation-helpers");
/******************************************************************************
 *                        ABSTRACT BASE CLASS
 *****************************************************************************/
/**
 * Abstract base class for an Agent.
 * Contains methods and attributes valid for Agents either created with CDK or imported.
 */
class AgentBase extends aws_cdk_lib_1.Resource {
}
exports.AgentBase = AgentBase;
_a = JSII_RTTI_SYMBOL_1;
AgentBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.AgentBase", version: "0.1.293" };
/******************************************************************************
 *                        NEW CONSTRUCT DEFINITION
 *****************************************************************************/
/**
 * Class to create (or import) an Agent with CDK.
 * @cloudformationResource AWS::Bedrock::Agent
 */
class Agent extends AgentBase {
    /**
     * Static Method for importing an existing Bedrock Agent.
     */
    static fromAgentAttrs(scope, id, attrs) {
        class Import extends AgentBase {
            constructor() {
                super(...arguments);
                this.agentArn = attrs.agentArn;
                this.agentId = aws_cdk_lib_1.Arn.split(attrs.agentArn, aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME).resourceName;
                this.role = iam.Role.fromRoleArn(scope, `${id}Role`, attrs.roleArn);
                this.kmsKey = attrs.kmsKeyArn ? kms.Key.fromKeyArn(scope, `${id}Key`, attrs.kmsKeyArn) : undefined;
                this.lastUpdated = attrs.lastUpdated;
                this.agentVersion = attrs.agentVersion ?? 'DRAFT';
            }
        }
        // Return new Agent
        return new Import(scope, id);
    }
    // ------------------------------------------------------
    // CONSTRUCTOR
    // ------------------------------------------------------
    constructor(scope, id, props) {
        super(scope, id);
        // ------------------------------------------------------
        // Validators
        // ------------------------------------------------------
        /**
         * Checks if the KB Association is valid
         *
         * @internal This is an internal core function and should not be called directly.
         */
        this.validateKnowledgeBase = (knowledgeBase) => {
            const MAX_LENGTH = 200;
            const description = knowledgeBase.instruction ?? knowledgeBase.description;
            const errors = [];
            // If at least one of the previous has been defined
            if (description) {
                errors.push(...validation.validateStringFieldLength({
                    value: description,
                    fieldName: 'description',
                    minLength: 0,
                    maxLength: MAX_LENGTH,
                }));
            }
            else {
                errors.push('If instructionForAgents is not provided, the description property of the KnowledgeBase ' +
                    `${knowledgeBase.knowledgeBaseId} must be provided.`);
            }
            return errors;
        };
        /**
         * Checks if the KB Associations are valid
         *
         * @internal This is an internal core function and should not be called directly.
         */
        this.validateKnowledgeBaseAssocations = () => {
            const MAX_KB_ASSOCIATIONS = 10;
            const errors = [];
            if (this.knowledgeBases.length > MAX_KB_ASSOCIATIONS) {
                errors.push(`The maximum number of knowledge bases associations is ${MAX_KB_ASSOCIATIONS}.`);
            }
            for (const kb of this.knowledgeBases) {
                this.validateKnowledgeBase(kb);
            }
            return errors;
        };
        /**
         * Checks if the Guardrail is valid
         *
         * @internal This is an internal core function and should not be called directly.
         */
        this.validateGuardrail = (guardrail) => {
            const errors = [];
            if (this.guardrail) {
                errors.push(`Cannot add Guardrail ${guardrail.guardrailId}. ` +
                    `Guardrail ${this.guardrail.guardrailId} has already been specified for this agent.`);
            }
            errors.push(...validation.validateFieldPattern(guardrail.guardrailVersion, 'version', /^(([0-9]{1,8})|(DRAFT))$/));
            return errors;
        };
        /**
         * Check if the action group is valid
         */
        this.validateActionGroup = (actionGroup) => {
            console.log('Validating action group: ', actionGroup.name);
            let errors = [];
            // Find if there is a conflicting action group name
            if (this.actionGroups?.find(ag => ag.name === actionGroup.name)) {
                errors.push(`An action group with name: ${actionGroup.name} has already been defined`);
            }
            return errors;
        };
        // ------------------------------------------------------
        // Set properties and defaults
        // ------------------------------------------------------
        this.name =
            props.name ?? (0, utils_1.generatePhysicalNameV2)(this, 'bedrock-agent', { maxLength: 64, lower: true, separator: '-' });
        this.idleSessionTTL = props.idleSessionTTL ?? aws_cdk_lib_1.Duration.hours(1);
        this.shouldPrepareAgent = props.shouldPrepareAgent ?? false;
        this.userInputEnabled = props.userInputEnabled ?? false;
        this.codeInterpreterEnabled = props.codeInterpreterEnabled ?? false;
        this.foundationModel = props.foundationModel;
        this.forceDelete = props.forceDelete ?? false;
        // Optional
        this.description = props.description;
        this.instruction = props.instruction;
        this.promptOverrideConfiguration = props.promptOverrideConfiguration;
        this.kmsKey = props.kmsKey;
        // ------------------------------------------------------
        // Role
        // ------------------------------------------------------
        // If existing role is provided, use it.
        if (props.existingRole) {
            this.role = props.existingRole;
            // Otherwise, create a new one
        }
        else {
            this.role = new iam.Role(this, 'Role', {
                // generate a role name
                roleName: (0, utils_1.generatePhysicalNameV2)(this, 'AmazonBedrockExecutionRoleForAgents_', { maxLength: 64, lower: false }),
                // ensure the role has a trust policy that allows the Bedrock service to assume the role
                assumedBy: new iam.ServicePrincipal('bedrock.amazonaws.com').withConditions({
                    StringEquals: {
                        'aws:SourceAccount': aws_cdk_lib_1.Stack.of(this).account,
                    },
                    ArnLike: {
                        'aws:SourceArn': aws_cdk_lib_1.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'agent',
                            resourceName: '*',
                            arnFormat: aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    },
                }),
            });
        }
        // ------------------------------------------------------
        // Set Lazy Props initial values
        // ------------------------------------------------------
        this.knowledgeBases = [];
        this.actionGroups = [];
        // Add Default Action Groups
        this.addActionGroup(action_group_1.AgentActionGroup.userInput(this.userInputEnabled));
        this.addActionGroup(action_group_1.AgentActionGroup.codeInterpreter(this.codeInterpreterEnabled));
        // Add specified elems through methods to handle permissions
        // this needs to happen after role creation / assignment
        props.knowledgeBases?.forEach(kb => {
            this.addKnowledgeBase(kb);
        });
        props.actionGroups?.forEach(ag => {
            this.addActionGroup(ag);
        });
        if (props.guardrail) {
            this.addGuardrail(props.guardrail);
        }
        // ------------------------------------------------------
        // Set Lazy Validations
        // ------------------------------------------------------
        this.node.addValidation({
            validate: () => this.validateKnowledgeBaseAssocations(),
        });
        // ------------------------------------------------------
        // CFN Props - With Lazy support
        // ------------------------------------------------------
        const cfnProps = {
            actionGroups: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderActionGroups() }, { omitEmptyArray: true }),
            agentName: this.name,
            agentResourceRoleArn: this.role.roleArn,
            autoPrepare: this.shouldPrepareAgent,
            customerEncryptionKeyArn: props.kmsKey?.keyArn,
            description: props.description,
            foundationModel: this.foundationModel.invokableArn,
            guardrailConfiguration: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderGuardrail() }),
            idleSessionTtlInSeconds: this.idleSessionTTL.toSeconds(),
            instruction: props.instruction,
            knowledgeBases: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderKnowledgeBases() }, { omitEmptyArray: true }),
            promptOverrideConfiguration: this.promptOverrideConfiguration?._render(),
            skipResourceInUseCheckOnDelete: this.forceDelete,
        };
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this.__resource = new bedrock.CfnAgent(this, 'AgentResource', cfnProps);
        this.agentId = this.__resource.attrAgentId;
        this.agentArn = this.__resource.attrAgentArn;
        this.agentVersion = this.__resource.attrAgentVersion;
        this.lastUpdated = this.__resource.attrUpdatedAt;
        // Add explicit dependency between the agent resource and the agent's role default policy
        // See https://github.com/awslabs/generative-ai-cdk-constructs/issues/899
        if (!props.existingRole) {
            // add the appropriate permissions to use the FM
            const grant = this.foundationModel.grantInvoke(this.role);
            grant.applyBefore(this.__resource);
        }
        this.testAlias = agent_alias_1.AgentAlias.fromAttributes(this, 'DefaultAlias', {
            aliasId: 'TSTALIASID',
            aliasName: 'AgentTestAlias',
            agentVersion: 'DRAFT',
            agent: this,
        });
    }
    // ------------------------------------------------------
    // HELPER METHODS - addX()
    // ------------------------------------------------------
    /**
     * Add knowledge base to the agent.
     */
    addKnowledgeBase(knowledgeBase) {
        // Do some checks
        validation.throwIfInvalid(this.validateKnowledgeBase, knowledgeBase);
        // Add it to the array
        this.knowledgeBases.push(knowledgeBase);
        // Add the appropriate Permissions to query the Knowledge Base
        knowledgeBase.grantQuery(this.role);
    }
    /**
     * Add guardrail to the agent.
     */
    addGuardrail(guardrail) {
        // Do some checks
        validation.throwIfInvalid(this.validateGuardrail, guardrail);
        // Add it to the construct
        this.guardrail = guardrail;
        // Handle permissions
        guardrail.grantApply(this.role);
    }
    /**
     * Add an action group to the agent.
     */
    addActionGroup(actionGroup) {
        // Do some checks
        validation.throwIfInvalid(this.validateActionGroup, actionGroup);
        // Add it to the array
        this.actionGroups.push(actionGroup);
        // Handle permissions to invoke the lambda function
        actionGroup.executor?.lambdaFunction?.grantInvoke(this.role);
        actionGroup.executor?.lambdaFunction?.addPermission(`LambdaInvocationPolicy-${this.node.addr.slice(0, 16)}`, {
            principal: new iam.ServicePrincipal('bedrock.amazonaws.com'),
            sourceArn: this.agentArn,
            sourceAccount: aws_cdk_lib_1.Stack.of(this).account,
        });
    }
    /**
     * Add multiple action groups to the agent.
     */
    addActionGroups(...actionGroups) {
        actionGroups.forEach(ag => this.addActionGroup(ag));
    }
    // ------------------------------------------------------
    // Lazy Renderers
    // ------------------------------------------------------
    /**
     * Render the guardrail configuration.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderGuardrail() {
        return this.guardrail
            ? {
                guardrailIdentifier: this.guardrail.guardrailId,
                guardrailVersion: this.guardrail.guardrailVersion,
            }
            : undefined;
    }
    /**
     * Render the knowledge base associations.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderKnowledgeBases() {
        const knowledgeBaseAssociationsCfn = [];
        // Build the associations in the CFN format
        this.knowledgeBases.forEach(kb => {
            knowledgeBaseAssociationsCfn.push({
                knowledgeBaseId: kb.knowledgeBaseId,
                knowledgeBaseState: 'ENABLED',
                // at least one is defined as it has been validated when adding the kb
                description: kb.instruction ?? kb.description,
            });
        });
        return knowledgeBaseAssociationsCfn;
    }
    /**
     * Render the action groups
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderActionGroups() {
        const actionGroupsCfn = [];
        // Build the associations in the CFN format
        this.actionGroups.forEach(ag => {
            actionGroupsCfn.push(ag._render());
        });
        return actionGroupsCfn;
    }
}
exports.Agent = Agent;
_b = JSII_RTTI_SYMBOL_1;
Agent[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.Agent", version: "0.1.293" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWdlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL2FnZW50cy9hZ2VudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBRUgsNkNBQXlGO0FBQ3pGLG1EQUFtRDtBQUNuRCwyQ0FBMkM7QUFDM0MsMkNBQTJDO0FBRTNDLGdCQUFnQjtBQUNoQixpREFBa0Q7QUFDbEQsK0NBQXdEO0FBRXhELHlEQUF1RTtBQUN2RSx5RUFBeUU7QUFxQ3pFOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBc0IsU0FBVSxTQUFRLHNCQUFROztBQUFoRCw4QkFPQzs7O0FBbUlEOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBYSxLQUFNLFNBQVEsU0FBUztJQUNsQzs7T0FFRztJQUNJLE1BQU0sQ0FBQyxjQUFjLENBQUMsS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBc0I7UUFDL0UsTUFBTSxNQUFPLFNBQVEsU0FBUztZQUE5Qjs7Z0JBQ2tCLGFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO2dCQUMxQixZQUFPLEdBQUcsaUJBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSx1QkFBUyxDQUFDLG1CQUFtQixDQUFDLENBQUMsWUFBYSxDQUFDO2dCQUNqRixTQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUMvRCxXQUFNLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7Z0JBQzlGLGdCQUFXLEdBQUcsS0FB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QjthQUNsRDtZQUNELENBQUMsQ0FBQyxTQUFTLENBQUM7SUFDaEIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSyxvQkFBb0I7UUFDMUIsTUFBTSw0QkFBNEIsR0FBa0QsRUFBRSxDQUFDO1FBQ3ZGLDJDQUEyQztRQUMzQyxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUMvQiw0QkFBNEIsQ0FBQyxJQUFJLENBQUM7Z0JBQ2hDLGVBQWUsRUFBRSxFQUFFLENBQUMsZUFBZTtnQkFDbkMsa0JBQWtCLEVBQUUsU0FBUztnQkFDN0Isc0VBQXNFO2dCQUN0RSxXQUFXLEVBQUUsRUFBRSxDQUFDLFdBQVcsSUFBSSxFQUFFLENBQUMsV0FBWTthQUMvQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sNEJBQTRCLENBQUM7SUFDdEMsQ0FBQztJQUVEOzs7O09BSUc7SUFDSyxrQkFBa0I7UUFDeEIsTUFBTSxlQUFlLEdBQWdELEVBQUUsQ0FBQztRQUN4RSwyQ0FBMkM7UUFDM0MsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUU7WUFDN0IsZUFBZSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUNyQyxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sZUFBZSxDQUFDO0lBQ3pCLENBQUM7O0FBclZILHNCQWlhQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEFybiwgQXJuRm9ybWF0LCBEdXJhdGlvbiwgSVJlc291cmNlLCBMYXp5LCBSZXNvdXJjZSwgU3RhY2sgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgKiBhcyBiZWRyb2NrIGZyb20gJ2F3cy1jZGstbGliL2F3cy1iZWRyb2NrJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIGttcyBmcm9tICdhd3MtY2RrLWxpYi9hd3Mta21zJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuLy8gSW50ZXJuYWwgTGlic1xuaW1wb3J0IHsgQWdlbnRBY3Rpb25Hcm91cCB9IGZyb20gJy4vYWN0aW9uLWdyb3VwJztcbmltcG9ydCB7IEFnZW50QWxpYXMsIElBZ2VudEFsaWFzIH0gZnJvbSAnLi9hZ2VudC1hbGlhcyc7XG5pbXBvcnQgeyBQcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24gfSBmcm9tICcuL3Byb21wdC1vdmVycmlkZSc7XG5pbXBvcnQgeyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvdXRpbHMnO1xuaW1wb3J0ICogYXMgdmFsaWRhdGlvbiBmcm9tICcuLi8uLi8uLi9jb21tb24vaGVscGVycy92YWxpZGF0aW9uLWhlbHBlcnMnO1xuaW1wb3J0IHsgSUd1YXJkcmFpbCB9IGZyb20gJy4uL2d1YXJkcmFpbHMvZ3VhcmRyYWlscyc7XG5pbXBvcnQgeyBJS25vd2xlZGdlQmFzZSB9IGZyb20gJy4uL2tub3dsZWRnZS1iYXNlcy9rbm93bGVkZ2UtYmFzZSc7XG5pbXBvcnQgeyBJSW52b2thYmxlIH0gZnJvbSAnLi4vbW9kZWxzJztcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDT01NT05cbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogUmVwcmVzZW50cyBhbiBBZ2VudCwgZWl0aGVyIGNyZWF0ZWQgd2l0aCBDREsgb3IgaW1wb3J0ZWQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSUFnZW50IGV4dGVuZHMgSVJlc291cmNlIHtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIGFnZW50LlxuICAgKiBAZXhhbXBsZSBcImFybjphd3M6YmVkcm9jazp1cy1lYXN0LTE6MTIzNDU2Nzg5MDEyOmFnZW50L09LRFNKT0dLTU9cIlxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICByZWFkb25seSBhZ2VudEFybjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSBBZ2VudC5cbiAgICogQGV4YW1wbGUgXCJPS0RTSk9HS01PXCJcbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcmVhZG9ubHkgYWdlbnRJZDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIElBTSByb2xlIGFzc29jaWF0ZWQgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcmVhZG9ubHkgcm9sZTogaWFtLklSb2xlO1xuICAvKipcbiAgICogT3B0aW9uYWwgS01TIGVuY3J5cHRpb24ga2V5IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGFnZW50XG4gICAqL1xuICByZWFkb25seSBrbXNLZXk/OiBrbXMuSUtleTtcbiAgLyoqXG4gICAqIFdoZW4gdGhpcyBhZ2VudCB3YXMgbGFzdCB1cGRhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgbGFzdFVwZGF0ZWQ/OiBzdHJpbmc7XG59XG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIEFCU1RSQUNUIEJBU0UgQ0xBU1NcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogQWJzdHJhY3QgYmFzZSBjbGFzcyBmb3IgYW4gQWdlbnQuXG4gKiBDb250YWlucyBtZXRob2RzIGFuZCBhdHRyaWJ1dGVzIHZhbGlkIGZvciBBZ2VudHMgZWl0aGVyIGNyZWF0ZWQgd2l0aCBDREsgb3IgaW1wb3J0ZWQuXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBZ2VudEJhc2UgZXh0ZW5kcyBSZXNvdXJjZSBpbXBsZW1lbnRzIElBZ2VudCB7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBhZ2VudEFybjogc3RyaW5nO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgYWdlbnRJZDogc3RyaW5nO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgcm9sZTogaWFtLklSb2xlO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkga21zS2V5Pzoga21zLklLZXk7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBsYXN0VXBkYXRlZD86IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IGFnZW50VmVyc2lvbjogc3RyaW5nO1xufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIFBST1BTIEZPUiBORVcgQ09OU1RSVUNUXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGNyZWF0aW5nIGEgQ0RLIG1hbmFnZWQgQmVkcm9jayBBZ2VudC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBZ2VudFByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBhZ2VudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBBIG5hbWUgaXMgZ2VuZXJhdGVkIGJ5IENESy5cbiAgICovXG4gIHJlYWRvbmx5IG5hbWU/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgaW5zdHJ1Y3Rpb24gdXNlZCBieSB0aGUgYWdlbnQuIFRoaXMgZGV0ZXJtaW5lcyBob3cgdGhlIGFnZW50IHdpbGwgcGVyZm9ybSBoaXMgdGFzay5cbiAgICogVGhpcyBpbnN0cnVjdGlvbiBtdXN0IGhhdmUgYSBtaW5pbXVtIG9mIDQwIGNoYXJhY3RlcnMuXG4gICAqL1xuICByZWFkb25seSBpbnN0cnVjdGlvbjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGZvdW5kYXRpb24gbW9kZWwgdXNlZCBmb3Igb3JjaGVzdHJhdGlvbiBieSB0aGUgYWdlbnQuXG4gICAqL1xuICByZWFkb25seSBmb3VuZGF0aW9uTW9kZWw6IElJbnZva2FibGU7XG4gIC8qKlxuICAgKiBUaGUgZXhpc3RpbmcgSUFNIFJvbGUgZm9yIHRoZSBhZ2VudCB0byB1c2UuXG4gICAqIEVuc3VyZSB0aGUgcm9sZSBoYXMgYSB0cnVzdCBwb2xpY3kgdGhhdCBhbGxvd3MgdGhlIEJlZHJvY2sgc2VydmljZSB0byBhc3N1bWUgdGhlIHJvbGUuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQSBuZXcgcm9sZSBpcyBjcmVhdGVkIGZvciB5b3UuXG4gICAqL1xuICByZWFkb25seSBleGlzdGluZ1JvbGU/OiBpYW0uSVJvbGU7XG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgd2hldGhlciB0byBhdXRvbWF0aWNhbGx5IHVwZGF0ZSB0aGUgYERSQUZUYCB2ZXJzaW9uIG9mIHRoZSBhZ2VudCBhZnRlclxuICAgKiBtYWtpbmcgY2hhbmdlcyB0byB0aGUgYWdlbnQuIFRoZSBgRFJBRlRgIHZlcnNpb24gY2FuIGJlIGNvbnRpbnVhbGx5IGl0ZXJhdGVkXG4gICAqIHVwb24gZHVyaW5nIGludGVybmFsIGRldmVsb3BtZW50LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGZhbHNlXG4gICAqL1xuICByZWFkb25seSBzaG91bGRQcmVwYXJlQWdlbnQ/OiBib29sZWFuO1xuICAvKipcbiAgICogSG93IGxvbmcgc2Vzc2lvbnMgc2hvdWxkIGJlIGtlcHQgb3BlbiBmb3IgdGhlIGFnZW50LiBJZiBubyBjb252ZXJzYXRpb24gb2NjdXJzXG4gICAqIGR1cmluZyB0aGlzIHRpbWUsIHRoZSBzZXNzaW9uIGV4cGlyZXMgYW5kIEFtYXpvbiBCZWRyb2NrIGRlbGV0ZXMgYW55IGRhdGFcbiAgICogcHJvdmlkZWQgYmVmb3JlIHRoZSB0aW1lb3V0LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIDEgaG91clxuICAgKi9cbiAgcmVhZG9ubHkgaWRsZVNlc3Npb25UVEw/OiBEdXJhdGlvbjtcbiAgLyoqXG4gICAqIFRoZSBLTVMga2V5IG9mIHRoZSBhZ2VudCBpZiBjdXN0b20gZW5jcnlwdGlvbiBpcyBjb25maWd1cmVkLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEFuIEFXUyBtYW5hZ2VkIGtleSBpcyB1c2VkLlxuICAgKi9cbiAgcmVhZG9ubHkga21zS2V5Pzoga21zLklLZXk7XG4gIC8qKlxuICAgKiBBIGRlc2NyaXB0aW9uIG9mIHRoZSBhZ2VudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBkZXNjcmlwdGlvbiBpcyBwcm92aWRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIEtub3dsZWRnZUJhc2VzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWdlbnQuXG4gICAqL1xuICByZWFkb25seSBrbm93bGVkZ2VCYXNlcz86IElLbm93bGVkZ2VCYXNlW107XG4gIC8qKlxuICAgKiBUaGUgQWN0aW9uIEdyb3VwcyBhc3NvY2lhdGVkIHdpdGggdGhlIGFnZW50LlxuICAgKi9cbiAgcmVhZG9ubHkgYWN0aW9uR3JvdXBzPzogQWdlbnRBY3Rpb25Hcm91cFtdO1xuICAvKipcbiAgICogVGhlIGd1YXJkcmFpbCB0aGF0IHdpbGwgYmUgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZ2VudC5cbiAgICovXG4gIHJlYWRvbmx5IGd1YXJkcmFpbD86IElHdWFyZHJhaWw7XG4gIC8qKlxuICAgKiBPdmVycmlkZXMgc29tZSBwcm9tcHQgdGVtcGxhdGVzIGluIGRpZmZlcmVudCBwYXJ0cyBvZiBhbiBhZ2VudCBzZXF1ZW5jZSBjb25maWd1cmF0aW9uLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIG92ZXJyaWRlcyBhcmUgcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBwcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24/OiBQcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb247XG4gIC8qKlxuICAgKiBTZWxlY3Qgd2hldGhlciB0aGUgYWdlbnQgY2FuIHByb21wdCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGZyb20gdGhlIHVzZXIgd2hlbiBpdCBkb2VzIG5vdCBoYXZlXG4gICAqIGVub3VnaCBpbmZvcm1hdGlvbiB0byByZXNwb25kIHRvIGFuIHV0dGVyYW5jZVxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGZhbHNlXG4gICAqL1xuICByZWFkb25seSB1c2VySW5wdXRFbmFibGVkPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFNlbGVjdCB3aGV0aGVyIHRoZSBhZ2VudCBjYW4gZ2VuZXJhdGUsIHJ1biwgYW5kIHRyb3VibGVzaG9vdCBjb2RlIHdoZW4gdHJ5aW5nIHRvIGNvbXBsZXRlIGEgdGFza1xuICAgKlxuICAgKiBAZGVmYXVsdCAtIGZhbHNlXG4gICAqL1xuICByZWFkb25seSBjb2RlSW50ZXJwcmV0ZXJFbmFibGVkPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gZGVsZXRlIHRoZSByZXNvdXJjZSBldmVuIGlmIGl0J3MgaW4gdXNlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHRydWVcbiAgICovXG4gIHJlYWRvbmx5IGZvcmNlRGVsZXRlPzogYm9vbGVhbjtcbn1cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgIEFUVFJTIEZPUiBJTVBPUlRFRCBDT05TVFJVQ1RcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogQXR0cmlidXRlcyBmb3Igc3BlY2lmeWluZyBhbiBpbXBvcnRlZCBCZWRyb2NrIEFnZW50LlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50QXR0cmlidXRlcyB7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBhZ2VudC5cbiAgICogQGV4YW1wbGUgXCJhcm46YXdzOmJlZHJvY2s6dXMtZWFzdC0xOjEyMzQ1Njc4OTAxMjphZ2VudC9PS0RTSk9HS01PXCJcbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcmVhZG9ubHkgYWdlbnRBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIElBTSByb2xlIGFzc29jaWF0ZWQgdG8gdGhlIGFnZW50LlxuICAgKiBAZXhhbXBsZSBcIlhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhcIlxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICByZWFkb25seSByb2xlQXJuOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBPcHRpb25hbCBLTVMgZW5jcnlwdGlvbiBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoaXMgYWdlbnRcbiAgICovXG4gIHJlYWRvbmx5IGttc0tleUFybj86IHN0cmluZztcbiAgLyoqXG4gICAqIFdoZW4gdGhpcyBhZ2VudCB3YXMgbGFzdCB1cGRhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgbGFzdFVwZGF0ZWQ/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgYWdlbnQgdmVyc2lvbi4gSWYgbm8gZXhwbGljaXQgdmVyc2lvbnMgaGF2ZSBiZWVuIGNyZWF0ZWQsXG4gICAqIGxlYXZlIHRoaXMgIGVtcHR5IHRvIHVzZSB0aGUgRFJBRlQgdmVyc2lvbi4gT3RoZXJ3aXNlLCB1c2UgdGhlXG4gICAqIHZlcnNpb24gbnVtYmVyIChlLmcuIDEpLlxuICAgKi9cbiAgcmVhZG9ubHkgYWdlbnRWZXJzaW9uPzogc3RyaW5nO1xufVxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICBORVcgQ09OU1RSVUNUIERFRklOSVRJT05cbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogQ2xhc3MgdG8gY3JlYXRlIChvciBpbXBvcnQpIGFuIEFnZW50IHdpdGggQ0RLLlxuICogQGNsb3VkZm9ybWF0aW9uUmVzb3VyY2UgQVdTOjpCZWRyb2NrOjpBZ2VudFxuICovXG5leHBvcnQgY2xhc3MgQWdlbnQgZXh0ZW5kcyBBZ2VudEJhc2Uge1xuICAvKipcbiAgICogU3RhdGljIE1ldGhvZCBmb3IgaW1wb3J0aW5nIGFuIGV4aXN0aW5nIEJlZHJvY2sgQWdlbnQuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGZyb21BZ2VudEF0dHJzKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIGF0dHJzOiBBZ2VudEF0dHJpYnV0ZXMpOiBJQWdlbnQge1xuICAgIGNsYXNzIEltcG9ydCBleHRlbmRzIEFnZW50QmFzZSB7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRBcm4gPSBhdHRycy5hZ2VudEFybjtcbiAgICAgIHB1YmxpYyByZWFkb25seSBhZ2VudElkID0gQXJuLnNwbGl0KGF0dHJzLmFnZW50QXJuLCBBcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSkucmVzb3VyY2VOYW1lITtcbiAgICAgIHB1YmxpYyByZWFkb25seSByb2xlID0gaWFtLlJvbGUuZnJvbVJvbGVBcm4oc2NvcGUsIGAke2lkfVJvbGVgLCBhdHRycy5yb2xlQXJuKTtcbiAgICAgIHB1YmxpYyByZWFkb25seSBrbXNLZXkgPSBhdHRycy5rbXNLZXlBcm4gPyBrbXMuS2V5LmZyb21LZXlBcm4oc2NvcGUsIGAke2lkfUtleWAsIGF0dHJzLmttc0tleUFybikgOiB1bmRlZmluZWQ7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgbGFzdFVwZGF0ZWQgPSBhdHRycy5sYXN0VXBkYXRlZDtcbiAgICAgIHB1YmxpYyByZWFkb25seSBhZ2VudFZlcnNpb24gPSBhdHRycy5hZ2VudFZlcnNpb24gPz8gJ0RSQUZUJztcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gbmV3IEFnZW50XG4gICAgcmV0dXJuIG5ldyBJbXBvcnQoc2NvcGUsIGlkKTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQmFzZSBhdHRyaWJ1dGVzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgYWdlbnRcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBhZ2VudElkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBhZ2VudEFybjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHZlcnNpb24gb2YgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFnZW50VmVyc2lvbjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIElBTSByb2xlIGFzc29jaWF0ZWQgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHJvbGU6IGlhbS5JUm9sZTtcbiAgLyoqXG4gICAqIE9wdGlvbmFsIEtNUyBlbmNyeXB0aW9uIGtleSBhc3NvY2lhdGVkIHdpdGggdGhpcyBhZ2VudFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGttc0tleT86IGttcy5JS2V5O1xuICAvKipcbiAgICogV2hlbiB0aGlzIGFnZW50IHdhcyBsYXN0IHVwZGF0ZWQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgbGFzdFVwZGF0ZWQ/OiBzdHJpbmc7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDREstb25seSBhdHRyaWJ1dGVzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBkZXNjcmlwdGlvbiBmb3IgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGluc3RydWN0aW9uIHVzZWQgYnkgdGhlIGFnZW50LiBUaGlzIGRldGVybWluZXMgaG93IHRoZSBhZ2VudCB3aWxsIHBlcmZvcm0gaGlzIHRhc2suXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgaW5zdHJ1Y3Rpb24/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBPdmVycmlkZXMgc29tZSBwcm9tcHQgdGVtcGxhdGVzIGluIGRpZmZlcmVudCBwYXJ0cyBvZiBhbiBhZ2VudCBzZXF1ZW5jZSBjb25maWd1cmF0aW9uLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIG92ZXJyaWRlcyBhcmUgcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBwcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24/OiBQcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb247XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBhZ2VudCB3aWxsIGF1dG9tYXRpY2FsbHkgdXBkYXRlIHRoZSBEUkFGVCB2ZXJzaW9uIG9mIHRoZSBhZ2VudCBhZnRlclxuICAgKiBtYWtpbmcgY2hhbmdlcyB0byB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgc2hvdWxkUHJlcGFyZUFnZW50OiBib29sZWFuO1xuICAvKipcbiAgICogSG93IGxvbmcgc2Vzc2lvbnMgc2hvdWxkIGJlIGtlcHQgb3BlbiBmb3IgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGlkbGVTZXNzaW9uVFRMOiBEdXJhdGlvbjtcbiAgLyoqXG4gICAqIFRoZSBmb3VuZGF0aW9uIG1vZGVsIHVzZWQgZm9yIG9yY2hlc3RyYXRpb24gYnkgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGZvdW5kYXRpb25Nb2RlbDogSUludm9rYWJsZTtcbiAgLyoqXG4gICAqIFRoZSBkZWZhdWx0IHRlc3QgYWxpYXMgZm9yIHRoaXMgYWdlbnQuIFRoaXMgY29ycmVzcG9uZHMgdG8gdGhlIHRlc3QgYWxpYXNcbiAgICogKGBUU1RBTElBU0lEYCkgdGhhdCBwb2ludHMgdG8gdGhlIHdvcmtpbmcgKGBEUkFGVGApIHZlcnNpb24uXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdGVzdEFsaWFzOiBJQWdlbnRBbGlhcztcbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGFnZW50IGNhbiBwcm9tcHQgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiBmcm9tIHRoZSB1c2VyIHdoZW4gaXQgZG9lcyBub3QgaGF2ZVxuICAgKiBlbm91Z2ggaW5mb3JtYXRpb24gdG8gcmVzcG9uZCB0byBhbiB1dHRlcmFuY2VcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB1c2VySW5wdXRFbmFibGVkOiBib29sZWFuO1xuICAvKipcbiAgICogV2hldGhlciB0aGUgYWdlbnQgY2FuIGdlbmVyYXRlLCBydW4sIGFuZCB0cm91Ymxlc2hvb3QgY29kZSB3aGVuIHRyeWluZyB0byBjb21wbGV0ZSBhIHRhc2suXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgY29kZUludGVycHJldGVyRW5hYmxlZDogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIHJlc291cmNlIHdpbGwgYmUgZGVsZXRlZCBldmVuIGlmIGl0J3MgaW4gdXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGZvcmNlRGVsZXRlOiBib29sZWFuO1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gTGF6eSBBdHRyaWJ1dGVzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIGFjdGlvbiBncm91cHMgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhY3Rpb25Hcm91cHM6IEFnZW50QWN0aW9uR3JvdXBbXTtcbiAgLyoqXG4gICAqIFRoZSBLbm93bGVkZ2VCYXNlcyBhc3NvY2lhdGVkIHdpdGggdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGtub3dsZWRnZUJhc2VzOiBJS25vd2xlZGdlQmFzZVtdO1xuICAvKipcbiAgICogVGhlIGd1YXJkcmFpbCBhc3NvY2lhdGVkIHdpdGggdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGd1YXJkcmFpbD86IElHdWFyZHJhaWw7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBJbnRlcm5hbCBPbmx5XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIEwxIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBhZ2VudFxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfX3Jlc291cmNlOiBiZWRyb2NrLkNmbkFnZW50O1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDT05TVFJVQ1RPUlxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IEFnZW50UHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gU2V0IHByb3BlcnRpZXMgYW5kIGRlZmF1bHRzXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5uYW1lID1cbiAgICAgIHByb3BzLm5hbWUgPz8gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMih0aGlzLCAnYmVkcm9jay1hZ2VudCcsIHsgbWF4TGVuZ3RoOiA2NCwgbG93ZXI6IHRydWUsIHNlcGFyYXRvcjogJy0nIH0pO1xuICAgIHRoaXMuaWRsZVNlc3Npb25UVEwgPSBwcm9wcy5pZGxlU2Vzc2lvblRUTCA/PyBEdXJhdGlvbi5ob3VycygxKTtcbiAgICB0aGlzLnNob3VsZFByZXBhcmVBZ2VudCA9IHByb3BzLnNob3VsZFByZXBhcmVBZ2VudCA/PyBmYWxzZTtcbiAgICB0aGlzLnVzZXJJbnB1dEVuYWJsZWQgPSBwcm9wcy51c2VySW5wdXRFbmFibGVkID8/IGZhbHNlO1xuICAgIHRoaXMuY29kZUludGVycHJldGVyRW5hYmxlZCA9IHByb3BzLmNvZGVJbnRlcnByZXRlckVuYWJsZWQgPz8gZmFsc2U7XG4gICAgdGhpcy5mb3VuZGF0aW9uTW9kZWwgPSBwcm9wcy5mb3VuZGF0aW9uTW9kZWw7XG4gICAgdGhpcy5mb3JjZURlbGV0ZSA9IHByb3BzLmZvcmNlRGVsZXRlID8/IGZhbHNlO1xuICAgIC8vIE9wdGlvbmFsXG4gICAgdGhpcy5kZXNjcmlwdGlvbiA9IHByb3BzLmRlc2NyaXB0aW9uO1xuICAgIHRoaXMuaW5zdHJ1Y3Rpb24gPSBwcm9wcy5pbnN0cnVjdGlvbjtcbiAgICB0aGlzLnByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbiA9IHByb3BzLnByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbjtcbiAgICB0aGlzLmttc0tleSA9IHByb3BzLmttc0tleTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFJvbGVcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBJZiBleGlzdGluZyByb2xlIGlzIHByb3ZpZGVkLCB1c2UgaXQuXG4gICAgaWYgKHByb3BzLmV4aXN0aW5nUm9sZSkge1xuICAgICAgdGhpcy5yb2xlID0gcHJvcHMuZXhpc3RpbmdSb2xlO1xuICAgICAgLy8gT3RoZXJ3aXNlLCBjcmVhdGUgYSBuZXcgb25lXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucm9sZSA9IG5ldyBpYW0uUm9sZSh0aGlzLCAnUm9sZScsIHtcbiAgICAgICAgLy8gZ2VuZXJhdGUgYSByb2xlIG5hbWVcbiAgICAgICAgcm9sZU5hbWU6IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ0FtYXpvbkJlZHJvY2tFeGVjdXRpb25Sb2xlRm9yQWdlbnRzXycsIHsgbWF4TGVuZ3RoOiA2NCwgbG93ZXI6IGZhbHNlIH0pLFxuICAgICAgICAvLyBlbnN1cmUgdGhlIHJvbGUgaGFzIGEgdHJ1c3QgcG9saWN5IHRoYXQgYWxsb3dzIHRoZSBCZWRyb2NrIHNlcnZpY2UgdG8gYXNzdW1lIHRoZSByb2xlXG4gICAgICAgIGFzc3VtZWRCeTogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdiZWRyb2NrLmFtYXpvbmF3cy5jb20nKS53aXRoQ29uZGl0aW9ucyh7XG4gICAgICAgICAgU3RyaW5nRXF1YWxzOiB7XG4gICAgICAgICAgICAnYXdzOlNvdXJjZUFjY291bnQnOiBTdGFjay5vZih0aGlzKS5hY2NvdW50LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgQXJuTGlrZToge1xuICAgICAgICAgICAgJ2F3czpTb3VyY2VBcm4nOiBTdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgICAgICAgIHJlc291cmNlOiAnYWdlbnQnLFxuICAgICAgICAgICAgICByZXNvdXJjZU5hbWU6ICcqJyxcbiAgICAgICAgICAgICAgYXJuRm9ybWF0OiBBcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG4gICAgfVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFNldCBMYXp5IFByb3BzIGluaXRpYWwgdmFsdWVzXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlcyA9IFtdO1xuICAgIHRoaXMuYWN0aW9uR3JvdXBzID0gW107XG4gICAgLy8gQWRkIERlZmF1bHQgQWN0aW9uIEdyb3Vwc1xuICAgIHRoaXMuYWRkQWN0aW9uR3JvdXAoQWdlbnRBY3Rpb25Hcm91cC51c2VySW5wdXQodGhpcy51c2VySW5wdXRFbmFibGVkKSk7XG4gICAgdGhpcy5hZGRBY3Rpb25Hcm91cChBZ2VudEFjdGlvbkdyb3VwLmNvZGVJbnRlcnByZXRlcih0aGlzLmNvZGVJbnRlcnByZXRlckVuYWJsZWQpKTtcblxuICAgIC8vIEFkZCBzcGVjaWZpZWQgZWxlbXMgdGhyb3VnaCBtZXRob2RzIHRvIGhhbmRsZSBwZXJtaXNzaW9uc1xuICAgIC8vIHRoaXMgbmVlZHMgdG8gaGFwcGVuIGFmdGVyIHJvbGUgY3JlYXRpb24gLyBhc3NpZ25tZW50XG4gICAgcHJvcHMua25vd2xlZGdlQmFzZXM/LmZvckVhY2goa2IgPT4ge1xuICAgICAgdGhpcy5hZGRLbm93bGVkZ2VCYXNlKGtiKTtcbiAgICB9KTtcbiAgICBwcm9wcy5hY3Rpb25Hcm91cHM/LmZvckVhY2goYWcgPT4ge1xuICAgICAgdGhpcy5hZGRBY3Rpb25Hcm91cChhZyk7XG4gICAgfSk7XG4gICAgaWYgKHByb3BzLmd1YXJkcmFpbCkge1xuICAgICAgdGhpcy5hZGRHdWFyZHJhaWwocHJvcHMuZ3VhcmRyYWlsKTtcbiAgICB9XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBTZXQgTGF6eSBWYWxpZGF0aW9uc1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMubm9kZS5hZGRWYWxpZGF0aW9uKHtcbiAgICAgIHZhbGlkYXRlOiAoKSA9PiB0aGlzLnZhbGlkYXRlS25vd2xlZGdlQmFzZUFzc29jYXRpb25zKCksXG4gICAgfSk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBDRk4gUHJvcHMgLSBXaXRoIExhenkgc3VwcG9ydFxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbnN0IGNmblByb3BzOiBiZWRyb2NrLkNmbkFnZW50UHJvcHMgPSB7XG4gICAgICBhY3Rpb25Hcm91cHM6IExhenkuYW55KHsgcHJvZHVjZTogKCkgPT4gdGhpcy5yZW5kZXJBY3Rpb25Hcm91cHMoKSB9LCB7IG9taXRFbXB0eUFycmF5OiB0cnVlIH0pLFxuICAgICAgYWdlbnROYW1lOiB0aGlzLm5hbWUsXG4gICAgICBhZ2VudFJlc291cmNlUm9sZUFybjogdGhpcy5yb2xlLnJvbGVBcm4sXG4gICAgICBhdXRvUHJlcGFyZTogdGhpcy5zaG91bGRQcmVwYXJlQWdlbnQsXG4gICAgICBjdXN0b21lckVuY3J5cHRpb25LZXlBcm46IHByb3BzLmttc0tleT8ua2V5QXJuLFxuICAgICAgZGVzY3JpcHRpb246IHByb3BzLmRlc2NyaXB0aW9uLFxuICAgICAgZm91bmRhdGlvbk1vZGVsOiB0aGlzLmZvdW5kYXRpb25Nb2RlbC5pbnZva2FibGVBcm4sXG4gICAgICBndWFyZHJhaWxDb25maWd1cmF0aW9uOiBMYXp5LmFueSh7IHByb2R1Y2U6ICgpID0+IHRoaXMucmVuZGVyR3VhcmRyYWlsKCkgfSksXG4gICAgICBpZGxlU2Vzc2lvblR0bEluU2Vjb25kczogdGhpcy5pZGxlU2Vzc2lvblRUTC50b1NlY29uZHMoKSxcbiAgICAgIGluc3RydWN0aW9uOiBwcm9wcy5pbnN0cnVjdGlvbixcbiAgICAgIGtub3dsZWRnZUJhc2VzOiBMYXp5LmFueSh7IHByb2R1Y2U6ICgpID0+IHRoaXMucmVuZGVyS25vd2xlZGdlQmFzZXMoKSB9LCB7IG9taXRFbXB0eUFycmF5OiB0cnVlIH0pLFxuICAgICAgcHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uOiB0aGlzLnByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbj8uX3JlbmRlcigpLFxuICAgICAgc2tpcFJlc291cmNlSW5Vc2VDaGVja09uRGVsZXRlOiB0aGlzLmZvcmNlRGVsZXRlLFxuICAgIH07XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBMMSBJbnN0YW50aWF0aW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5fX3Jlc291cmNlID0gbmV3IGJlZHJvY2suQ2ZuQWdlbnQodGhpcywgJ0FnZW50UmVzb3VyY2UnLCBjZm5Qcm9wcyk7XG5cbiAgICB0aGlzLmFnZW50SWQgPSB0aGlzLl9fcmVzb3VyY2UuYXR0ckFnZW50SWQ7XG4gICAgdGhpcy5hZ2VudEFybiA9IHRoaXMuX19yZXNvdXJjZS5hdHRyQWdlbnRBcm47XG4gICAgdGhpcy5hZ2VudFZlcnNpb24gPSB0aGlzLl9fcmVzb3VyY2UuYXR0ckFnZW50VmVyc2lvbjtcbiAgICB0aGlzLmxhc3RVcGRhdGVkID0gdGhpcy5fX3Jlc291cmNlLmF0dHJVcGRhdGVkQXQ7XG5cbiAgICAvLyBBZGQgZXhwbGljaXQgZGVwZW5kZW5jeSBiZXR3ZWVuIHRoZSBhZ2VudCByZXNvdXJjZSBhbmQgdGhlIGFnZW50J3Mgcm9sZSBkZWZhdWx0IHBvbGljeVxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vYXdzbGFicy9nZW5lcmF0aXZlLWFpLWNkay1jb25zdHJ1Y3RzL2lzc3Vlcy84OTlcbiAgICBpZiAoIXByb3BzLmV4aXN0aW5nUm9sZSkge1xuICAgICAgLy8gYWRkIHRoZSBhcHByb3ByaWF0ZSBwZXJtaXNzaW9ucyB0byB1c2UgdGhlIEZNXG4gICAgICBjb25zdCBncmFudCA9IHRoaXMuZm91bmRhdGlvbk1vZGVsLmdyYW50SW52b2tlKHRoaXMucm9sZSk7XG4gICAgICBncmFudC5hcHBseUJlZm9yZSh0aGlzLl9fcmVzb3VyY2UpO1xuICAgIH1cblxuICAgIHRoaXMudGVzdEFsaWFzID0gQWdlbnRBbGlhcy5mcm9tQXR0cmlidXRlcyh0aGlzLCAnRGVmYXVsdEFsaWFzJywge1xuICAgICAgYWxpYXNJZDogJ1RTVEFMSUFTSUQnLFxuICAgICAgYWxpYXNOYW1lOiAnQWdlbnRUZXN0QWxpYXMnLFxuICAgICAgYWdlbnRWZXJzaW9uOiAnRFJBRlQnLFxuICAgICAgYWdlbnQ6IHRoaXMsXG4gICAgfSk7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gSEVMUEVSIE1FVEhPRFMgLSBhZGRYKClcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBBZGQga25vd2xlZGdlIGJhc2UgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEtub3dsZWRnZUJhc2Uoa25vd2xlZGdlQmFzZTogSUtub3dsZWRnZUJhc2UpIHtcbiAgICAvLyBEbyBzb21lIGNoZWNrc1xuICAgIHZhbGlkYXRpb24udGhyb3dJZkludmFsaWQodGhpcy52YWxpZGF0ZUtub3dsZWRnZUJhc2UsIGtub3dsZWRnZUJhc2UpO1xuICAgIC8vIEFkZCBpdCB0byB0aGUgYXJyYXlcbiAgICB0aGlzLmtub3dsZWRnZUJhc2VzLnB1c2goa25vd2xlZGdlQmFzZSk7XG4gICAgLy8gQWRkIHRoZSBhcHByb3ByaWF0ZSBQZXJtaXNzaW9ucyB0byBxdWVyeSB0aGUgS25vd2xlZGdlIEJhc2VcbiAgICBrbm93bGVkZ2VCYXNlLmdyYW50UXVlcnkodGhpcy5yb2xlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgZ3VhcmRyYWlsIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhZGRHdWFyZHJhaWwoZ3VhcmRyYWlsOiBJR3VhcmRyYWlsKSB7XG4gICAgLy8gRG8gc29tZSBjaGVja3NcbiAgICB2YWxpZGF0aW9uLnRocm93SWZJbnZhbGlkKHRoaXMudmFsaWRhdGVHdWFyZHJhaWwsIGd1YXJkcmFpbCk7XG4gICAgLy8gQWRkIGl0IHRvIHRoZSBjb25zdHJ1Y3RcbiAgICB0aGlzLmd1YXJkcmFpbCA9IGd1YXJkcmFpbDtcbiAgICAvLyBIYW5kbGUgcGVybWlzc2lvbnNcbiAgICBndWFyZHJhaWwuZ3JhbnRBcHBseSh0aGlzLnJvbGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBhY3Rpb24gZ3JvdXAgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEFjdGlvbkdyb3VwKGFjdGlvbkdyb3VwOiBBZ2VudEFjdGlvbkdyb3VwKSB7XG4gICAgLy8gRG8gc29tZSBjaGVja3NcbiAgICB2YWxpZGF0aW9uLnRocm93SWZJbnZhbGlkKHRoaXMudmFsaWRhdGVBY3Rpb25Hcm91cCwgYWN0aW9uR3JvdXApO1xuICAgIC8vIEFkZCBpdCB0byB0aGUgYXJyYXlcbiAgICB0aGlzLmFjdGlvbkdyb3Vwcy5wdXNoKGFjdGlvbkdyb3VwKTtcbiAgICAvLyBIYW5kbGUgcGVybWlzc2lvbnMgdG8gaW52b2tlIHRoZSBsYW1iZGEgZnVuY3Rpb25cbiAgICBhY3Rpb25Hcm91cC5leGVjdXRvcj8ubGFtYmRhRnVuY3Rpb24/LmdyYW50SW52b2tlKHRoaXMucm9sZSk7XG4gICAgYWN0aW9uR3JvdXAuZXhlY3V0b3I/LmxhbWJkYUZ1bmN0aW9uPy5hZGRQZXJtaXNzaW9uKGBMYW1iZGFJbnZvY2F0aW9uUG9saWN5LSR7dGhpcy5ub2RlLmFkZHIuc2xpY2UoMCwgMTYpfWAsIHtcbiAgICAgIHByaW5jaXBhbDogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdiZWRyb2NrLmFtYXpvbmF3cy5jb20nKSxcbiAgICAgIHNvdXJjZUFybjogdGhpcy5hZ2VudEFybixcbiAgICAgIHNvdXJjZUFjY291bnQ6IFN0YWNrLm9mKHRoaXMpLmFjY291bnQsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIG11bHRpcGxlIGFjdGlvbiBncm91cHMgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEFjdGlvbkdyb3VwcyguLi5hY3Rpb25Hcm91cHM6IEFnZW50QWN0aW9uR3JvdXBbXSkge1xuICAgIGFjdGlvbkdyb3Vwcy5mb3JFYWNoKGFnID0+IHRoaXMuYWRkQWN0aW9uR3JvdXAoYWcpKTtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBMYXp5IFJlbmRlcmVyc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFJlbmRlciB0aGUgZ3VhcmRyYWlsIGNvbmZpZ3VyYXRpb24uXG4gICAqXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSByZW5kZXJHdWFyZHJhaWwoKTogYmVkcm9jay5DZm5BZ2VudC5HdWFyZHJhaWxDb25maWd1cmF0aW9uUHJvcGVydHkgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmd1YXJkcmFpbFxuICAgICAgPyB7XG4gICAgICAgIGd1YXJkcmFpbElkZW50aWZpZXI6IHRoaXMuZ3VhcmRyYWlsLmd1YXJkcmFpbElkLFxuICAgICAgICBndWFyZHJhaWxWZXJzaW9uOiB0aGlzLmd1YXJkcmFpbC5ndWFyZHJhaWxWZXJzaW9uLFxuICAgICAgfVxuICAgICAgOiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIHRoZSBrbm93bGVkZ2UgYmFzZSBhc3NvY2lhdGlvbnMuXG4gICAqXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSByZW5kZXJLbm93bGVkZ2VCYXNlcygpOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5W10ge1xuICAgIGNvbnN0IGtub3dsZWRnZUJhc2VBc3NvY2lhdGlvbnNDZm46IGJlZHJvY2suQ2ZuQWdlbnQuQWdlbnRLbm93bGVkZ2VCYXNlUHJvcGVydHlbXSA9IFtdO1xuICAgIC8vIEJ1aWxkIHRoZSBhc3NvY2lhdGlvbnMgaW4gdGhlIENGTiBmb3JtYXRcbiAgICB0aGlzLmtub3dsZWRnZUJhc2VzLmZvckVhY2goa2IgPT4ge1xuICAgICAga25vd2xlZGdlQmFzZUFzc29jaWF0aW9uc0Nmbi5wdXNoKHtcbiAgICAgICAga25vd2xlZGdlQmFzZUlkOiBrYi5rbm93bGVkZ2VCYXNlSWQsXG4gICAgICAgIGtub3dsZWRnZUJhc2VTdGF0ZTogJ0VOQUJMRUQnLFxuICAgICAgICAvLyBhdCBsZWFzdCBvbmUgaXMgZGVmaW5lZCBhcyBpdCBoYXMgYmVlbiB2YWxpZGF0ZWQgd2hlbiBhZGRpbmcgdGhlIGtiXG4gICAgICAgIGRlc2NyaXB0aW9uOiBrYi5pbnN0cnVjdGlvbiA/PyBrYi5kZXNjcmlwdGlvbiEsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4ga25vd2xlZGdlQmFzZUFzc29jaWF0aW9uc0NmbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW5kZXIgdGhlIGFjdGlvbiBncm91cHNcbiAgICpcbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIHJlbmRlckFjdGlvbkdyb3VwcygpOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50QWN0aW9uR3JvdXBQcm9wZXJ0eVtdIHtcbiAgICBjb25zdCBhY3Rpb25Hcm91cHNDZm46IGJlZHJvY2suQ2ZuQWdlbnQuQWdlbnRBY3Rpb25Hcm91cFByb3BlcnR5W10gPSBbXTtcbiAgICAvLyBCdWlsZCB0aGUgYXNzb2NpYXRpb25zIGluIHRoZSBDRk4gZm9ybWF0XG4gICAgdGhpcy5hY3Rpb25Hcm91cHMuZm9yRWFjaChhZyA9PiB7XG4gICAgICBhY3Rpb25Hcm91cHNDZm4ucHVzaChhZy5fcmVuZGVyKCkpO1xuICAgIH0pO1xuICAgIHJldHVybiBhY3Rpb25Hcm91cHNDZm47XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gVmFsaWRhdG9yc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIENoZWNrcyBpZiB0aGUgS0IgQXNzb2NpYXRpb24gaXMgdmFsaWRcbiAgICpcbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlS25vd2xlZGdlQmFzZSA9IChrbm93bGVkZ2VCYXNlOiBJS25vd2xlZGdlQmFzZSk6IHN0cmluZ1tdID0+IHtcbiAgICBjb25zdCBNQVhfTEVOR1RIID0gMjAwO1xuICAgIGNvbnN0IGRlc2NyaXB0aW9uID0ga25vd2xlZGdlQmFzZS5pbnN0cnVjdGlvbiA/PyBrbm93bGVkZ2VCYXNlLmRlc2NyaXB0aW9uO1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICAvLyBJZiBhdCBsZWFzdCBvbmUgb2YgdGhlIHByZXZpb3VzIGhhcyBiZWVuIGRlZmluZWRcbiAgICBpZiAoZGVzY3JpcHRpb24pIHtcbiAgICAgIGVycm9ycy5wdXNoKFxuICAgICAgICAuLi52YWxpZGF0aW9uLnZhbGlkYXRlU3RyaW5nRmllbGRMZW5ndGgoe1xuICAgICAgICAgIHZhbHVlOiBkZXNjcmlwdGlvbixcbiAgICAgICAgICBmaWVsZE5hbWU6ICdkZXNjcmlwdGlvbicsXG4gICAgICAgICAgbWluTGVuZ3RoOiAwLFxuICAgICAgICAgIG1heExlbmd0aDogTUFYX0xFTkdUSCxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBlcnJvcnMucHVzaChcbiAgICAgICAgJ0lmIGluc3RydWN0aW9uRm9yQWdlbnRzIGlzIG5vdCBwcm92aWRlZCwgdGhlIGRlc2NyaXB0aW9uIHByb3BlcnR5IG9mIHRoZSBLbm93bGVkZ2VCYXNlICcgK1xuICAgICAgICAgIGAke2tub3dsZWRnZUJhc2Uua25vd2xlZGdlQmFzZUlkfSBtdXN0IGJlIHByb3ZpZGVkLmAsXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gZXJyb3JzO1xuICB9O1xuICAvKipcbiAgICogQ2hlY2tzIGlmIHRoZSBLQiBBc3NvY2lhdGlvbnMgYXJlIHZhbGlkXG4gICAqXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZUtub3dsZWRnZUJhc2VBc3NvY2F0aW9ucyA9ICgpOiBzdHJpbmdbXSA9PiB7XG4gICAgY29uc3QgTUFYX0tCX0FTU09DSUFUSU9OUyA9IDEwO1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICBpZiAodGhpcy5rbm93bGVkZ2VCYXNlcy5sZW5ndGggPiBNQVhfS0JfQVNTT0NJQVRJT05TKSB7XG4gICAgICBlcnJvcnMucHVzaChgVGhlIG1heGltdW0gbnVtYmVyIG9mIGtub3dsZWRnZSBiYXNlcyBhc3NvY2lhdGlvbnMgaXMgJHtNQVhfS0JfQVNTT0NJQVRJT05TfS5gKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBrYiBvZiB0aGlzLmtub3dsZWRnZUJhc2VzKSB7XG4gICAgICB0aGlzLnZhbGlkYXRlS25vd2xlZGdlQmFzZShrYik7XG4gICAgfVxuICAgIHJldHVybiBlcnJvcnM7XG4gIH07XG4gIC8qKlxuICAgKiBDaGVja3MgaWYgdGhlIEd1YXJkcmFpbCBpcyB2YWxpZFxuICAgKlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVHdWFyZHJhaWwgPSAoZ3VhcmRyYWlsOiBJR3VhcmRyYWlsKTogc3RyaW5nW10gPT4ge1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICBpZiAodGhpcy5ndWFyZHJhaWwpIHtcbiAgICAgIGVycm9ycy5wdXNoKFxuICAgICAgICBgQ2Fubm90IGFkZCBHdWFyZHJhaWwgJHtndWFyZHJhaWwuZ3VhcmRyYWlsSWR9LiBgICtcbiAgICAgICAgICBgR3VhcmRyYWlsICR7dGhpcy5ndWFyZHJhaWwuZ3VhcmRyYWlsSWR9IGhhcyBhbHJlYWR5IGJlZW4gc3BlY2lmaWVkIGZvciB0aGlzIGFnZW50LmAsXG4gICAgICApO1xuICAgIH1cbiAgICBlcnJvcnMucHVzaCguLi52YWxpZGF0aW9uLnZhbGlkYXRlRmllbGRQYXR0ZXJuKGd1YXJkcmFpbC5ndWFyZHJhaWxWZXJzaW9uLCAndmVyc2lvbicsIC9eKChbMC05XXsxLDh9KXwoRFJBRlQpKSQvKSk7XG4gICAgcmV0dXJuIGVycm9ycztcbiAgfTtcbiAgLyoqXG4gICAqIENoZWNrIGlmIHRoZSBhY3Rpb24gZ3JvdXAgaXMgdmFsaWRcbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVBY3Rpb25Hcm91cCA9IChhY3Rpb25Hcm91cDogQWdlbnRBY3Rpb25Hcm91cCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdWYWxpZGF0aW5nIGFjdGlvbiBncm91cDogJywgYWN0aW9uR3JvdXAubmFtZSk7XG4gICAgbGV0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICAvLyBGaW5kIGlmIHRoZXJlIGlzIGEgY29uZmxpY3RpbmcgYWN0aW9uIGdyb3VwIG5hbWVcbiAgICBpZiAodGhpcy5hY3Rpb25Hcm91cHM/LmZpbmQoYWcgPT4gYWcubmFtZSA9PT0gYWN0aW9uR3JvdXAubmFtZSkpIHtcbiAgICAgIGVycm9ycy5wdXNoKGBBbiBhY3Rpb24gZ3JvdXAgd2l0aCBuYW1lOiAke2FjdGlvbkdyb3VwLm5hbWV9IGhhcyBhbHJlYWR5IGJlZW4gZGVmaW5lZGApO1xuICAgIH1cbiAgICByZXR1cm4gZXJyb3JzO1xuICB9O1xufVxuIl19